
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta
            name="description"
            content="Documentation for drift protocol-v2"
        >
    <title>protocol-v2 API</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-37e63de6.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-966d6edc.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-b12a2749.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>`
  </head>

  <body class="index" data-languages="[&quot;typescript&quot;,&quot;python&quot;,&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <div class="logo-wrapper">
        <img src="images/logo-a64972c9.png" class="logo" alt="" />
      </div>
        <div class="lang-selector">
              <a href="#" data-language-name="typescript">typescript</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="shell">http</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#terms-of-use" class="toc-h1 toc-link" data-title="Terms of Use">Terms of Use</a>
          </li>
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#program-addresses" class="toc-h2 toc-link" data-title="Program Addresses">Program Addresses</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
          </li>
          <li>
            <a href="#client" class="toc-h1 toc-link" data-title="Client">Client</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#typescript" class="toc-h2 toc-link" data-title="Typescript">Typescript</a>
                  </li>
                  <li>
                    <a href="#python" class="toc-h2 toc-link" data-title="Python">Python</a>
                  </li>
                  <li>
                    <a href="#http" class="toc-h2 toc-link" data-title="HTTP">HTTP</a>
                  </li>
                  <li>
                    <a href="#connection" class="toc-h2 toc-link" data-title="Connection">Connection</a>
                  </li>
                  <li>
                    <a href="#wallet" class="toc-h2 toc-link" data-title="Wallet">Wallet</a>
                  </li>
                  <li>
                    <a href="#client-initialization" class="toc-h2 toc-link" data-title="Client Initialization">Client Initialization</a>
                  </li>
                  <li>
                    <a href="#user-initialization" class="toc-h2 toc-link" data-title="User Initialization">User Initialization</a>
                  </li>
                  <li>
                    <a href="#updating-user" class="toc-h2 toc-link" data-title="Updating User">Updating User</a>
                  </li>
                  <li>
                    <a href="#switching-sub-accounts" class="toc-h2 toc-link" data-title="Switching Sub Accounts">Switching Sub Accounts</a>
                  </li>
                  <li>
                    <a href="#deleting-user-account" class="toc-h2 toc-link" data-title="Deleting User Account">Deleting User Account</a>
                  </li>
                  <li>
                    <a href="#depositing" class="toc-h2 toc-link" data-title="Depositing">Depositing</a>
                  </li>
                  <li>
                    <a href="#withdrawing" class="toc-h2 toc-link" data-title="Withdrawing">Withdrawing</a>
                  </li>
                  <li>
                    <a href="#transferring-deposits" class="toc-h2 toc-link" data-title="Transferring Deposits">Transferring Deposits</a>
                  </li>
                  <li>
                    <a href="#order-types" class="toc-h2 toc-link" data-title="Order Types">Order Types</a>
                  </li>
                  <li>
                    <a href="#order-params" class="toc-h2 toc-link" data-title="Order Params">Order Params</a>
                  </li>
                  <li>
                    <a href="#post-only-params" class="toc-h2 toc-link" data-title="Post Only Params">Post Only Params</a>
                  </li>
                  <li>
                    <a href="#placing-perp-order" class="toc-h2 toc-link" data-title="Placing Perp Order">Placing Perp Order</a>
                  </li>
                  <li>
                    <a href="#placing-spot-order" class="toc-h2 toc-link" data-title="Placing Spot Order">Placing Spot Order</a>
                  </li>
                  <li>
                    <a href="#placing-multiple-orders" class="toc-h2 toc-link" data-title="Placing Multiple Orders">Placing Multiple Orders</a>
                  </li>
                  <li>
                    <a href="#placing-oracle-market-orders" class="toc-h2 toc-link" data-title="Placing Oracle Market Orders">Placing Oracle Market Orders</a>
                  </li>
                  <li>
                    <a href="#canceling-order" class="toc-h2 toc-link" data-title="Canceling Order">Canceling Order</a>
                  </li>
                  <li>
                    <a href="#canceling-order-by-user-order-id" class="toc-h2 toc-link" data-title="Canceling Order By User Order Id">Canceling Order By User Order Id</a>
                  </li>
                  <li>
                    <a href="#cancel-orders" class="toc-h2 toc-link" data-title="Cancel Orders">Cancel Orders</a>
                  </li>
                  <li>
                    <a href="#cancel-and-place-orders" class="toc-h2 toc-link" data-title="Cancel and Place Orders">Cancel and Place Orders</a>
                  </li>
                  <li>
                    <a href="#modify-order-params" class="toc-h2 toc-link" data-title="Modify Order Params">Modify Order Params</a>
                  </li>
                  <li>
                    <a href="#modifying-order" class="toc-h2 toc-link" data-title="Modifying Order">Modifying Order</a>
                  </li>
                  <li>
                    <a href="#modifying-order-by-user-order-id" class="toc-h2 toc-link" data-title="Modifying Order By User Order Id">Modifying Order By User Order Id</a>
                  </li>
                  <li>
                    <a href="#settle-perp-pnl" class="toc-h2 toc-link" data-title="Settle Perp PNL">Settle Perp PNL</a>
                  </li>
                  <li>
                    <a href="#get-spot-market-account" class="toc-h2 toc-link" data-title="Get Spot Market Account">Get Spot Market Account</a>
                  </li>
                  <li>
                    <a href="#get-perp-market-account" class="toc-h2 toc-link" data-title="Get Perp Market Account">Get Perp Market Account</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#user" class="toc-h1 toc-link" data-title="User">User</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-user" class="toc-h2 toc-link" data-title="Get User">Get User</a>
                  </li>
                  <li>
                    <a href="#getting-deposit-borrow-amounts" class="toc-h2 toc-link" data-title="Getting Deposit/Borrow Amounts">Getting Deposit/Borrow Amounts</a>
                  </li>
                  <li>
                    <a href="#get-perp-position" class="toc-h2 toc-link" data-title="Get Perp Position">Get Perp Position</a>
                  </li>
                  <li>
                    <a href="#get-order" class="toc-h2 toc-link" data-title="Get Order">Get Order</a>
                  </li>
                  <li>
                    <a href="#get-order-by-user-order-id" class="toc-h2 toc-link" data-title="Get Order By User Order Id">Get Order By User Order Id</a>
                  </li>
                  <li>
                    <a href="#get-open-orders" class="toc-h2 toc-link" data-title="Get Open Orders">Get Open Orders</a>
                  </li>
                  <li>
                    <a href="#get-unrealized-perp-pnl" class="toc-h2 toc-link" data-title="Get Unrealized Perp Pnl">Get Unrealized Perp Pnl</a>
                  </li>
                  <li>
                    <a href="#get-unrealized-funding-pnl" class="toc-h2 toc-link" data-title="Get Unrealized Funding Pnl">Get Unrealized Funding Pnl</a>
                  </li>
                  <li>
                    <a href="#get-total-collateral" class="toc-h2 toc-link" data-title="Get Total Collateral">Get Total Collateral</a>
                  </li>
                  <li>
                    <a href="#get-margin-requirement" class="toc-h2 toc-link" data-title="Get Margin Requirement">Get Margin Requirement</a>
                  </li>
                  <li>
                    <a href="#get-free-collateral" class="toc-h2 toc-link" data-title="Get Free Collateral">Get Free Collateral</a>
                  </li>
                  <li>
                    <a href="#get-leverage" class="toc-h2 toc-link" data-title="Get Leverage">Get Leverage</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#events" class="toc-h1 toc-link" data-title="Events">Events</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#event-subscription" class="toc-h2 toc-link" data-title="Event Subscription">Event Subscription</a>
                  </li>
                  <li>
                    <a href="#event-types" class="toc-h2 toc-link" data-title="Event Types">Event Types</a>
                  </li>
                  <li>
                    <a href="#listening-to-perp-market-fills" class="toc-h2 toc-link" data-title="Listening to Perp Market Fills">Listening to Perp Market Fills</a>
                  </li>
                  <li>
                    <a href="#listening-to-user-fills" class="toc-h2 toc-link" data-title="Listening to User Fills">Listening to User Fills</a>
                  </li>
                  <li>
                    <a href="#getting-events-received-by-type" class="toc-h2 toc-link" data-title="Getting Events Received By Type">Getting Events Received By Type</a>
                  </li>
                  <li>
                    <a href="#getting-events-by-transaction" class="toc-h2 toc-link" data-title="Getting Events By Transaction">Getting Events By Transaction</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#margin-system" class="toc-h1 toc-link" data-title="Margin System">Margin System</a>
          </li>
          <li>
            <a href="#numerical-precisions" class="toc-h1 toc-link" data-title="Numerical Precisions">Numerical Precisions</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getting-a-current-perp-position" class="toc-h2 toc-link" data-title="Getting a Current Perp Position">Getting a Current Perp Position</a>
                  </li>
                  <li>
                    <a href="#getting-a-current-spot-position" class="toc-h2 toc-link" data-title="Getting a Current Spot Position">Getting a Current Spot Position</a>
                  </li>
                  <li>
                    <a href="#common-precision-values" class="toc-h2 toc-link" data-title="Common precision values">Common precision values</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#examples-bots" class="toc-h1 toc-link" data-title="Examples Bots">Examples Bots</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#typescript" class="toc-h2 toc-link" data-title="Typescript">Typescript</a>
                  </li>
                  <li>
                    <a href="#python" class="toc-h2 toc-link" data-title="Python">Python</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#orderbook-blockchain" class="toc-h1 toc-link" data-title="Orderbook (Blockchain)">Orderbook (Blockchain)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#dlob-source" class="toc-h2 toc-link" data-title="Dlob Source">Dlob Source</a>
                  </li>
                  <li>
                    <a href="#dlob-source-usermap" class="toc-h2 toc-link" data-title="Dlob Source - UserMap">Dlob Source - <code>UserMap</code></a>
                  </li>
                  <li>
                    <a href="#dlob-source-ordersubscriber" class="toc-h2 toc-link" data-title="Dlob Source - OrderSubscriber">Dlob Source - <code>OrderSubscriber</code></a>
                  </li>
                  <li>
                    <a href="#orderbook-subscription" class="toc-h2 toc-link" data-title="Orderbook Subscription">Orderbook Subscription</a>
                  </li>
                  <li>
                    <a href="#get-l2-orderbook" class="toc-h2 toc-link" data-title="Get L2 Orderbook">Get L2 Orderbook</a>
                  </li>
                  <li>
                    <a href="#get-l3-orderbook" class="toc-h2 toc-link" data-title="Get L3 Orderbook">Get L3 Orderbook</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#orderbook-trades-dlob-server" class="toc-h1 toc-link" data-title="Orderbook/Trades (DLOB Server)">Orderbook/Trades (DLOB Server)</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-l2" class="toc-h2 toc-link" data-title="GET /l2"><code>GET /l2</code></a>
                  </li>
                  <li>
                    <a href="#get-l3" class="toc-h2 toc-link" data-title="GET /l3"><code>GET /l3</code></a>
                  </li>
                  <li>
                    <a href="#get-topmakers" class="toc-h2 toc-link" data-title="GET /topMakers"><code>GET /topMakers</code></a>
                  </li>
                  <li>
                    <a href="#websocket" class="toc-h2 toc-link" data-title="Websocket">Websocket</a>
                  </li>
                  <li>
                    <a href="#websocket-subscribing" class="toc-h2 toc-link" data-title="Websocket - Subscribing">Websocket - Subscribing</a>
                  </li>
                  <li>
                    <a href="#websocket-unsubscribing" class="toc-h2 toc-link" data-title="Websocket - Unsubscribing">Websocket - Unsubscribing</a>
                  </li>
                  <li>
                    <a href="#websocket-liveness-measure" class="toc-h2 toc-link" data-title="Websocket - Liveness measure">Websocket - Liveness measure</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#data-api" class="toc-h1 toc-link" data-title="Data API">Data API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#rate-limiting" class="toc-h2 toc-link" data-title="Rate Limiting">Rate Limiting</a>
                  </li>
                  <li>
                    <a href="#caching" class="toc-h2 toc-link" data-title="Caching">Caching</a>
                  </li>
                  <li>
                    <a href="#get-contracts" class="toc-h2 toc-link" data-title="GET /contracts"><code>GET /contracts</code></a>
                  </li>
                  <li>
                    <a href="#get-drift" class="toc-h2 toc-link" data-title="GET /DRIFT/"><code>GET /DRIFT/</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#historical-data" class="toc-h1 toc-link" data-title="Historical Data">Historical Data</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#url-prefix" class="toc-h2 toc-link" data-title="URL Prefix">URL Prefix</a>
                  </li>
                  <li>
                    <a href="#url-suffix" class="toc-h2 toc-link" data-title="URL Suffix">URL Suffix</a>
                  </li>
                  <li>
                    <a href="#examples" class="toc-h2 toc-link" data-title="Examples">Examples</a>
                  </li>
                  <li>
                    <a href="#records-columns" class="toc-h2 toc-link" data-title="Records Columns">Records Columns</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
          <li>
            <a href="#market-indexes-names" class="toc-h1 toc-link" data-title="Market Indexes/Names">Market Indexes/Names</a>
          </li>
          <li>
            <a href="#prediction-markets" class="toc-h1 toc-link" data-title="Prediction Markets">Prediction Markets</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://github.com/drift-labs/protocol-v2/releases/'> Release History </a></li>
            <li><a href='https://docs.drift.trade/'> Documentation </a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='terms-of-use'>Terms of Use</h1>
<p>By using any API provided by Drift Labs, you agree to the <a href="https://docs.drift.trade/legal-and-regulations/terms-of-use">Terms of Use</a>. If you do not agree to the foregoing, then do not use any such API.</p>
<h1 id='introduction'>Introduction</h1>
<p>Drift Protocol is an <a href="https://github.com/drift-labs/protocol-v2/">open-sourced</a>, decentralised exchange built on the <a href="https://solana.com">Solana</a> blockchain, enabling transparent and non-custodial trading on cryptocurrencies.</p>

<p>There are language bindings in <a href="https://github.com/drift-labs/protocol-v2/tree/master/sdk">Typescript</a> and <a href="https://github.com/drift-labs/driftpy">Python</a>! You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>

<p>This API documentation page is open sourced and available <a href="https://github.com/drift-labs/v2-teacher">here</a> was created with <a href="https://github.com/slatedocs/slate">Slate</a>. Feel free to submit questions/comments in <a href="https://github.com/drift-labs/v2-teacher/issues">Issues</a> or suggest changes as a <a href="https://github.com/drift-labs/v2-teacher/pulls">PR</a>.</p>
<h2 id='program-addresses'>Program Addresses</h2>
<aside class="notice">
  All documented descriptions are for the following deployed programs IDs of the protocol.
</aside>

<table><thead>
<tr>
<th>Enviroment</th>
<th>Program ID</th>
<th>User Interface</th>
</tr>
</thead><tbody>
<tr>
<td>mainnet-beta</td>
<td><a href="https://solscan.io/account/dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH">dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH</a></td>
<td><a href="https://app.drift.trade">app</a></td>
</tr>
<tr>
<td>devnet</td>
<td><a href="https://solscan.io/account/dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH?cluster=devnet">dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH</a></td>
<td><a href="https://beta.drift.trade">app</a></td>
</tr>
</tbody></table>

<aside class="warning">
  It is strictly against the <a href="https://docs.drift.trade/legal-and-regulations/terms-of-use">Terms of Use</a> to use these interfaces from a Restricted Territory.
</aside>
<h1 id='authentication'>Authentication</h1>
<p>To access and interact with a blockchain, such as Solana, you need a keypair, which consists of a public key and a private key. The private key should be kept secure and not shared with anyone else.</p>

<p>To generate a new keypair, you can use the <a href="https://docs.solana.com/cli/install-solana-cli-tools">Solana Tool Suite</a> by running the following command on the command line:</p>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="nx">solana</span><span class="o">-</span><span class="nx">keygen</span> <span class="k">new</span> <span class="o">--</span><span class="nx">outfile</span> <span class="o">~</span><span class="sr">/.config/</span><span class="nx">solana</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">keypair</span><span class="p">.</span><span class="nx">json</span>
</code></pre></div>
<p>This command will create a new keypair and store it in a JSON file located at ~/.config/solana/my-keypair.json.</p>

<p>To allow SDK code to use this keypair for authentication, you need to set the ANCHOR_WALLET environment variable to the path of the JSON file that contains the keypair. You can do this by running the following command:</p>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">export</span> <span class="nx">ANCHOR_WALLET</span><span class="o">=~</span><span class="sr">/.config/</span><span class="nx">solana</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">keypair</span><span class="p">.</span><span class="nx">json</span>
</code></pre></div>
<p>This command sets the ANCHOR_WALLET environment variable to the path of the JSON file that contains your keypair, so that SDK code can access it when needed.</p>

<aside class="notice">
  You must replace <code>~/.config/solana/my-keypair.json</code> with your personal key.
</aside>
<h1 id='client'>Client</h1><h2 id='typescript'>Typescript</h2>
<p>Install @drift-labs/sdk from <a href="https://www.npmjs.com/package/@drift-labs/sdk">npm</a> using yarn:</p>

<p><code>yarn add @drift-labs/sdk</code></p>

<p>auto-generated documentation here: [https://drift-labs.github.io/protocol-v2/sdk/]</p>
<h2 id='python'>Python</h2>
<p>Install driftpy from PyPI using pip:</p>

<p><code>pip install driftpy</code></p>

<p>auto-generated documentation here: [https://drift-labs.github.io/driftpy/]</p>
<h2 id='http'>HTTP</h2>
<p>Use the self-hosted HTTP <a href="https://github.com/drift-labs/gateway">gateway</a></p>
<h2 id='connection'>Connection</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Connection</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@solana/web3.js</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// the default RPC for devnet is `https://api.devnet.solana.com`</span>
<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://api.mainnet-beta.solana.com</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">solana.rpc.async_api</span> <span class="kn">import</span> <span class="n">AsyncClient</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'https://api.mainnet-beta.solana.com'</span> <span class="c1"># replace w/ any rpc
</span><span class="n">connection</span> <span class="o">=</span> <span class="n">AsyncClient</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>drift-gateway https://api.mainnet-beta.solana.com <span class="nt">--port</span> 8080
</code></pre></div>
<p>The connection object is used to send transactions to the Solana blockchain. It is used by the DriftClient to send transactions to the blockchain.</p>
<h2 id='wallet'>Wallet</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Wallet</span><span class="p">,</span> <span class="nx">loadKeypair</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@drift-labs/sdk</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">keyPairFile</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">}</span><span class="s2">/.config/solana/my-keypair.json`</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wallet</span><span class="p">(</span><span class="nx">loadKeypair</span><span class="p">(</span><span class="nx">keyPairFile</span><span class="p">));</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">anchorpy</span> <span class="kn">import</span> <span class="n">Wallet</span>
<span class="kn">from</span> <span class="nn">driftpy.keypair</span> <span class="kn">import</span> <span class="n">load_keypair</span>

<span class="n">keypair_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">'~/.config/solana/my-keypair.json'</span><span class="p">)</span>
<span class="n">keypair</span> <span class="o">=</span> <span class="n">load_keypair</span><span class="p">(</span><span class="n">keypair_file</span><span class="p">)</span>
<span class="n">wallet</span> <span class="o">=</span> <span class="n">Wallet</span><span class="p">(</span><span class="n">kp</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code><span class="c"># use `DRIFT_GATEWAY_KEY` environment variable to configure the gateway wallet</span>
<span class="c"># either path to .json keypair or base58 seed string</span>
<span class="nb">export </span><span class="nv">DRIFT_GATEWAY_KEY</span><span class="o">=</span><span class="s2">"&lt;/path/to/my-keypair.json|&lt;KEYPAIR_BASE58_SEED&gt;"</span>
</code></pre></div>
<p>The wallet used to sign solana transactions. The wallet can be created from a private key or from a keypair file.</p>

<p>Make sure this wallet has some SOL first. SOL is used to pay for transactions and is required as rent for account intializations.</p>
<h2 id='client-initialization'>Client Initialization</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Connection</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@solana/web3.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">Wallet</span><span class="p">,</span> <span class="nx">loadKeypair</span><span class="p">,</span> <span class="nx">DriftClient</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@drift-labs/sdk</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://api.mainnet-beta.solana.com</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">keyPairFile</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">}</span><span class="s2">/.config/solana/my-keypair.json`</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wallet</span><span class="p">(</span><span class="nx">loadKeypair</span><span class="p">(</span><span class="nx">keyPairFile</span><span class="p">))</span>

<span class="kd">const</span> <span class="nx">driftClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DriftClient</span><span class="p">({</span>
  <span class="nx">connection</span><span class="p">,</span>
  <span class="nx">wallet</span><span class="p">,</span>
  <span class="na">env</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mainnet-beta</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="kn">from</span> <span class="nn">anchorpy</span> <span class="kn">import</span> <span class="n">Wallet</span>
  <span class="kn">from</span> <span class="nn">driftpy.drift_client</span> <span class="kn">import</span> <span class="n">DriftClient</span>
  <span class="kn">from</span> <span class="nn">solana.rpc.async_api</span> <span class="kn">import</span> <span class="n">AsyncClient</span>

  <span class="c1"># set connection and wallet
</span>  <span class="c1"># ...
</span>  <span class="n">drift_client</span> <span class="o">=</span> <span class="n">DriftClient</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">wallet</span><span class="p">,</span> <span class="s">"mainnet"</span><span class="p">)</span>
</code></pre></div><h3 id='typescript-2'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>connection</td>
<td>Connection object specifying solana rpc url</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>wallet</td>
<td>The wallet used to sign transactions sent to solana blockchain</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>programId</td>
<td>Drift program id</td>
<td>Yes</td>
<td>dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH</td>
</tr>
<tr>
<td>env</td>
<td><code>devnet</code> or <code>mainnet-beta</code>. Used to automatically derive market accounts to subscribe to if they&#39;re not explicitly set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>perpMarketIndexes</td>
<td>Which perp markets accounts to subscribe to.</td>
<td>Yes</td>
<td>Derived based on env</td>
</tr>
<tr>
<td>spotMarketIndexes</td>
<td>Which spot markets accounts to subscribe to.</td>
<td>Yes</td>
<td>Derived based on env</td>
</tr>
<tr>
<td>oracleInfos</td>
<td>Which oracles accounts to subscribe to.</td>
<td>Yes</td>
<td>Derived based on env</td>
</tr>
<tr>
<td>accountSubscription</td>
<td>Whether to use websocket or polling to subscribe to on-chain accounts e.g. markets, users, oracle.</td>
<td>Yes</td>
<td>Websockets</td>
</tr>
<tr>
<td>opts</td>
<td>Transaction confirmation status options</td>
<td>Yes</td>
<td>{preflightCommitment: &quot;processed&quot;, commitment: &quot;processed&quot;}</td>
</tr>
<tr>
<td>activeSubAccountId</td>
<td>Which sub account to use initially</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>subAccountIds</td>
<td>All the sub account ids to subscribe to. If this and authoritySubAccountMap are empty, subscribes to all sub account ids.</td>
<td>Yes</td>
<td>[]</td>
</tr>
<tr>
<td>authority</td>
<td>Which user account authority you&#39;re signing for. Only set if you&#39;re signing for delegated account.</td>
<td>Yes</td>
<td>wallet.publicKey</td>
</tr>
<tr>
<td>authoritySubAccountMap</td>
<td>Map of authority to sub account ids to subscribe to. Only necessary if using multiple delegate accounts. If this and subAccountIds are empty, subscribes to all sub account ids.</td>
<td>Yes</td>
<td>{}</td>
</tr>
<tr>
<td>includeDelegates</td>
<td>Whether or not to subscribe to delegates when subAccountIds and authoritySubAccountMap are empty</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>userStats</td>
<td>Whether or not to listen subscribe to user stats account.</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='python-2'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>connection</td>
<td>AsyncClient connection to the Solana cluster</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>wallet</td>
<td>Wallet object, can be Keypair or Wallet type</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>env</td>
<td>Drift environment, &#39;devnet&#39; or &#39;mainnet&#39;</td>
<td>Yes</td>
<td>&quot;mainnet&quot;</td>
</tr>
<tr>
<td>program_id</td>
<td>Drift program identifier</td>
<td>Yes</td>
<td>DRIFT_PROGRAM_ID</td>
</tr>
<tr>
<td>opts</td>
<td>Options for transaction confirmation status</td>
<td>Yes</td>
<td>DEFAULT_TX_OPTIONS</td>
</tr>
<tr>
<td>authority</td>
<td>Public key of the user account authority</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>account_subscription</td>
<td>Configuration for account subscriptions (websockets/polling)</td>
<td>Yes</td>
<td>AccountSubscriptionConfig.default()</td>
</tr>
<tr>
<td>perp_market_indexes</td>
<td>List of perpetual market indexes to interact with</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>spot_market_indexes</td>
<td>List of spot market indexes to interact with</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>oracle_infos</td>
<td>List of OracleInfo objects for market data</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>tx_params</td>
<td>Additional parameters for transactions</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>tx_version</td>
<td>Version of the transaction</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>tx_sender</td>
<td>Object handling the sending of transactions</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>active_sub_account_id</td>
<td>ID of the initially active sub-account</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>sub_account_ids</td>
<td>List of sub-account IDs to subscribe to</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>market_lookup_table</td>
<td>Public key for the market lookup table</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>
<h2 id='user-initialization'>User Initialization</h2>
<aside class="notice">
  initializing a new drift user account requires some rent (~.035 SOL). this can be reclaimed upon deletion.
</aside>

<aside class="notice">
  Alternatively you can export the private key of an existing user that has been initialized via the UI. This will allow you to use the same user account programatically.
</aside>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="p">[</span><span class="nx">txSig</span><span class="p">,</span> <span class="nx">userPublickKey</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">initializeUserAccount</span><span class="p">(</span>
  <span class="mi">0</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">toly</span><span class="dl">"</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">tx_sig</span> <span class="o">=</span> <span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">initialize_user</span><span class="p">(</span><span class="n">sub_account_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"toly"</span><span class="p">)</span>
</code></pre></div><h3 id='typescript-3'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>subAccountId</td>
<td>The sub account id for the new user account.</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>name</td>
<td>Display name for the user account</td>
<td>Yes</td>
<td>Main Account</td>
</tr>
<tr>
<td>referrerInfo</td>
<td>The address of the referrer and referrer stats accounts</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-3'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>sub_account_id</td>
<td>The sub account id for the new user account.</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>name</td>
<td>Display name for the user account</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>referrer_info</td>
<td>The address of the referrer and referrer stats accounts</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>

<p>Sub account ids are monotonic. The first user account created will have sub account id 0, the second will have sub account id 1, etc.
The next sub account id can be found by calling <code>driftClient.getNextSubAccountId()</code> in TypeScript.</p>
<h2 id='updating-user'>Updating User</h2>
<p>Users accounts can update names, set custom max intial margin ratio, enable margin trading, and add a delegate account.</p>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">subaccountId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// set max 1x intiial leverage</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">updateUserCustomMarginRatio</span><span class="p">([</span>
    <span class="p">{</span>
        <span class="dl">'</span><span class="s1">marginRatio</span><span class="dl">'</span><span class="p">:</span> <span class="nx">MARGIN_PRECISION</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">subAccountId</span><span class="dl">'</span><span class="p">:</span> <span class="nx">subaccountId</span>
    <span class="p">}</span>
<span class="p">]);</span>

<span class="c1">// enable spot margin trading</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">updateUserMarginTradingEnabled</span><span class="p">(</span>
  <span class="kc">true</span><span class="p">,</span>
  <span class="nx">subaccountId</span>
<span class="p">);</span>

<span class="c1">// add a delegate this user account</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">updateUserDelegate</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">PublicKey</span><span class="p">(</span><span class="dl">'</span><span class="s1">satoshi</span><span class="dl">'</span><span class="p">),</span>
  <span class="nx">subaccountId</span>
<span class="p">);</span>
</code></pre></div><h2 id='switching-sub-accounts'>Switching Sub Accounts</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="nx">driftClient</span><span class="p">.</span><span class="nx">switchActiveUser</span><span class="p">(</span>
  <span class="mi">1</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">drift_client</span><span class="p">.</span><span class="n">switch_active_user</span><span class="p">(</span><span class="n">sub_account_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<h3 id='typescript-4'>TypeScript</h3>
<p>=======
<code>shell
curl http://localhost:8080/v2/resource?subAccountId=1
</code></p>

<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>upstream/main
| Parameter   | Description | Optional | Default |
| ----------- | ----------- | -------- | ------- |
| subAccountId | The sub account to switch to  | No | 0 |
| authority   | The authority of the sub account you&#39;re signing for. Only needed for delegate accounts | Yes | Current authority |</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h3 id='python-4'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>sub_account_id</td>
<td>Identifier for the sub-account to be activated</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h2 id='deleting-user-account'>Deleting User Account</h2>
<p>If an account contains no assets or liabilites, a user account can be deleted to reclaim rent.</p>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="nx">driftClient</span><span class="p">.</span><span class="nx">deleteUser</span><span class="p">(</span>
  <span class="mi">1</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div><h2 id='depositing'>Depositing</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// USDC</span>
<span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToSpotPrecision</span><span class="p">(</span><span class="nx">marketIndex</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span> <span class="c1">// $100</span>
<span class="kd">const</span> <span class="nx">associatedTokenAccount</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getAssociatedTokenAccount</span><span class="p">(</span><span class="nx">marketIndex</span><span class="p">);</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">deposit</span><span class="p">(</span>
  <span class="nx">amount</span><span class="p">,</span>
  <span class="nx">marketIndex</span><span class="p">,</span>
  <span class="nx">associatedTokenAccount</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">spot_market_index</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># USDC
</span><span class="n">amount</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_spot_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">spot_market_index</span><span class="p">)</span> <span class="c1"># $100
</span>
<span class="n">tx_sig</span> <span class="o">=</span> <span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">spot_market_index</span><span class="p">)</span>
</code></pre></div><h3 id='typescript-5'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>The amount to deposit in spot market&#39;s token mint precision</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The spot market index you&#39;re depositing into</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>associatedTokenAccount</td>
<td>The public key of the token account you&#39;re depositing from. For sol, it can be the wallet&#39;s public key</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>subAccountId</td>
<td>The sub account you&#39;re depositing to</td>
<td>Yes</td>
<td>active sub account</td>
</tr>
<tr>
<td>reduceOnly</td>
<td>Whether the deposit should only reduce borrow</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='python-5'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>The amount to deposit in the spot market&#39;s token mint precision</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>spot_market_index</td>
<td>The index of the spot market where the deposit is made</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>user_token_account</td>
<td>The public key of the token account from which you are depositing</td>
<td>Yes</td>
<td>None (will derive ATA)</td>
</tr>
<tr>
<td>sub_account_id</td>
<td>The sub account to which the deposit is being made</td>
<td>Yes</td>
<td>Active sub-account</td>
</tr>
<tr>
<td>reduce_only</td>
<td>Whether the deposit should only reduce borrow</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>user_initialized</td>
<td>Indicates if the user is already initialized (used internally, typically)</td>
<td>Yes</td>
<td>true</td>
</tr>
</tbody></table>
<h2 id='withdrawing'>Withdrawing</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToSpotPrecision</span><span class="p">(</span><span class="nx">marketIndex</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">associatedTokenAccount</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getAssociatedTokenAccount</span><span class="p">(</span><span class="nx">marketIndex</span><span class="p">);</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">(</span>
  <span class="nx">amount</span><span class="p">,</span>
  <span class="nx">marketIndex</span><span class="p">,</span>
  <span class="nx">associatedTokenAccount</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># USDC
</span><span class="n">amount</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_spot_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">market_index</span><span class="p">)</span> <span class="c1"># $100
</span>
<span class="c1"># derive user ata to withdraw to
# ...
</span>
<span class="n">tx_sig</span> <span class="o">=</span> <span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">spot_market_index</span><span class="p">,</span> <span class="n">ata_to_withdraw_to</span><span class="p">)</span>
</code></pre></div><h3 id='typescript-6'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>The amount to withdraw in spot market&#39;s token mint precision</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The spot market index you&#39;re withdrawing from</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>associatedTokenAccount</td>
<td>The public key of the token account you&#39;re withdrawing to. For sol, it can be the wallet&#39;s public key</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>reduceOnly</td>
<td>Whether the withdraw should only decrease a deposit and block a new borrow</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='python-6'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>The amount to withdraw in the spot market&#39;s token mint precision</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>market_index</td>
<td>The index of the spot market from which the withdrawal is made</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>user_token_account</td>
<td>The public key of the token account to which you are withdrawing</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>reduce_only</td>
<td>Whether the withdrawal should only decrease a deposit, blocking new borrows</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>sub_account_id</td>
<td>The sub account from which the withdrawal is made</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>

<p>Withdrawing can lead to a borrow if the user has no deposits in the market and the user has enough margin to cover it.</p>
<h2 id='transferring-deposits'>Transferring Deposits</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToSpotPrecision</span><span class="p">(</span><span class="nx">marketIndex</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fromSubAccountId</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">toSubAccountId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">transferDeposit</span><span class="p">(</span>
  <span class="nx">amount</span><span class="p">,</span>
  <span class="nx">marketIndex</span><span class="p">,</span>
  <span class="nx">fromSubAccountId</span><span class="p">,</span>
  <span class="nx">toSubAccountId</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> <span class="n">HEAD</span>
<span class="n">amount</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_spot_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">market_index</span><span class="p">)</span>
<span class="o">=======</span>
<span class="n">amount</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_spot_precision</span><span class="p">(</span><span class="n">market_index</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span> <span class="n">upstream</span><span class="o">/</span><span class="n">main</span>
<span class="n">from_sub_account_id</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">to_sub_account_id</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">transfer_deposit</span><span class="p">(</span>
  <span class="n">amount</span><span class="p">,</span>
  <span class="n">market_index</span><span class="p">,</span>
  <span class="n">from_sub_account_id</span><span class="p">,</span>
  <span class="n">to_sub_account_id</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div><h3 id='typescript-7'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>The amount to transfer in spot market&#39;s token mint precision</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The spot market index you&#39;re transferring deposits in</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>fromSubAccountId</td>
<td>The sub account you&#39;re withdrawing from</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>toSubAccountId</td>
<td>The sub account you&#39;re depositing too</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-7'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>amount</td>
<td>The amount to transfer in the spot market&#39;s token mint precision</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>market_index</td>
<td>The spot market index you&#39;re transferring deposits in</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>from_sub_account_id</td>
<td>The sub account from which the funds are withdrawn</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>to_sub_account_id</td>
<td>The sub account to which the funds are deposited</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h2 id='order-types'>Order Types</h2><h3 id='typescript-8'>TypeScript</h3>
<p>MARKET, LIMIT, ORACLE orders all support auction parameters.</p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>MARKET</td>
<td>Market order.</td>
</tr>
<tr>
<td>LIMIT</td>
<td>Limit order.</td>
</tr>
<tr>
<td>TRIGGER_MARKET</td>
<td>Stop / Take-profit market order.</td>
</tr>
<tr>
<td>TRIGGER_LIMIT</td>
<td>Stop / Take-profit limit order.</td>
</tr>
<tr>
<td>ORACLE</td>
<td>Market order using oracle offset for auction parameters.</td>
</tr>
</tbody></table>
<h3 id='python-8'>Python</h3>
<p>Market(), Limit(), Oracle() orders all support auction parameters.</p>

<table><thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Market()</td>
<td>Market order.</td>
</tr>
<tr>
<td>Limit()</td>
<td>Limit order.</td>
</tr>
<tr>
<td>TriggerMarket()</td>
<td>Stop / Take-profit market order.</td>
</tr>
<tr>
<td>TriggerLimit()</td>
<td>Stop / Take-profit limit order.</td>
</tr>
<tr>
<td>Oracle()</td>
<td>Market order using oracle offset for auction parameters.</td>
</tr>
</tbody></table>
<h2 id='order-params'>Order Params</h2><h3 id='typescript-9'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>orderType</td>
<td>The type of order e.g. market, limit</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The market to place order in</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>direction</td>
<td>The direction of order e.g. long (bid) or short (ask)</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>baseAssetAmount</td>
<td>The amount of base asset to buy or sell</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>marketType</td>
<td>The type of market order is for e.g. PERP or SPOT</td>
<td>Yes</td>
<td>Depends on method</td>
</tr>
<tr>
<td>price</td>
<td>The limit price for order</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>userOrderId</td>
<td>Unique order id specified by user</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>reduceOnly</td>
<td>If the order can only reduce positions</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>postOnly</td>
<td>If the order can only be a maker</td>
<td>PostOnlyParam</td>
<td>None</td>
</tr>
<tr>
<td>triggerPrice</td>
<td>at what price order is triggered. only applicable for triggerMarket and triggerLimit orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>triggerCondition</td>
<td>whether order is triggered above or below triggerPrice. only applicable for triggerMarket and triggerLimit orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>oraclePriceOffset</td>
<td>priceOffset for oracle derived limit price. only applicable for limit and oracle orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>auctionDuration</td>
<td>how many slots the auction lasts. only applicable for market and oracle orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>auctionStartPrice</td>
<td>the price the auction starts at</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>auctionEndPrice</td>
<td>the price the auction ends at</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>maxTs</td>
<td>the max timestamp (on-chain unix timestamp) before the order expires</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-9'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>order_type</td>
<td>Type of order</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>market_index</td>
<td>Index of the market to place order in</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>direction</td>
<td>Direction of the order</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>base_asset_amount</td>
<td>Amount of base asset to buy or sell</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>market_type</td>
<td>Type of market</td>
<td>Yes</td>
<td>Depends on method</td>
</tr>
<tr>
<td>price</td>
<td>Limit price for the order</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>user_order_id</td>
<td>Unique order ID specified by user</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>reduce_only</td>
<td>Whether the order is only to reduce positions</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>post_only</td>
<td>If the order should only be a maker</td>
<td>Yes</td>
<td>PostOnlyParams.NONE()</td>
</tr>
<tr>
<td>immediate_or_cancel</td>
<td>Whether the order is immediate or cancel</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>max_ts</td>
<td>Max timestamp for the order expiry</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>trigger_price</td>
<td>Trigger price for trigger orders</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>trigger_condition</td>
<td>Condition for triggering the order</td>
<td>Yes</td>
<td>OrderTriggerCondition.Above()</td>
</tr>
<tr>
<td>oracle_price_offset</td>
<td>Offset for oracle-derived limit price</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>auction_duration</td>
<td>Duration of the auction in slots</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>auction_start_price</td>
<td>Starting price of the auction</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>auction_end_price</td>
<td>Ending price of the auction</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>
<h2 id='post-only-params'>Post Only Params</h2>
<p>Drift orderbook is not a strict clob that enforces price-time priority. This is to maximize the parallelization of placing orders to
take advantage of the solana runtime. To force an order to always be a maker, users most set the post only params. If a user order is set to post only,
drift will check that an order does not cross the vamm spread, similar to how a traditional clob would check that an order doesn&#39;t cross the book&#39;s best bid/ask.
If the post only is not used, a limit order can end up being a taker or maker.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>None</td>
<td>Does not enforce being maker</td>
</tr>
<tr>
<td>MustPostOnly</td>
<td>Tx fails if order crosses the vamm</td>
</tr>
<tr>
<td>TryPostOnly</td>
<td>Order is skipped (not placed) and tx succeeds if order crosses the vamm</td>
</tr>
<tr>
<td>Slide</td>
<td>Order price is modified to be one tick below/above the vamm ask/bid</td>
</tr>
</tbody></table>
<h2 id='placing-perp-order'>Placing Perp Order</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="c1">// market buy for 100 SOL-PERP @ $21.20-&gt;$21.30 over 60 slots (~30 seconds)</span>
<span class="c1">// after 60 slots, market buy 100 SOL-PERP @ $21.35 until maxTs</span>
<span class="kd">const</span> <span class="nx">orderParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">MARKET</span><span class="p">,</span>
  <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">LONG</span><span class="p">,</span>
  <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
  <span class="na">auctionStartPrice</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(</span><span class="mf">21.20</span><span class="p">),</span>
  <span class="na">auctionEndPrice</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(</span><span class="mf">21.30</span><span class="p">),</span>
  <span class="na">price</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(</span><span class="mf">21.35</span><span class="p">),</span>
  <span class="na">auctionDuration</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
  <span class="na">maxTs</span><span class="p">:</span> <span class="nx">now</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">placePerpOrder</span><span class="p">(</span><span class="nx">orderParams</span><span class="p">);</span>

<span class="c1">// bid for 100 SOL-PERP @ $21.23</span>
<span class="kd">const</span> <span class="nx">orderParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">LIMIT</span><span class="p">,</span>
  <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">LONG</span><span class="p">,</span>
  <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
  <span class="na">price</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(</span><span class="mf">21.23</span><span class="p">),</span>
<span class="p">}</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">placePerpOrder</span><span class="p">(</span><span class="nx">orderParams</span><span class="p">);</span>

<span class="c1">// ask for 100 SOL-PERP @ ${OraclePrice} + .05</span>
<span class="kd">const</span> <span class="nx">orderParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">LIMIT</span><span class="p">,</span>
  <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">SHORT</span><span class="p">,</span>
  <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
  <span class="na">oraclePriceOffset</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(.</span><span class="mi">05</span><span class="p">).</span><span class="nx">toNumber</span><span class="p">(),</span>
<span class="p">}</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">placePerpOrder</span><span class="p">(</span><span class="nx">orderParams</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">driftpy.types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">driftpy.constants.numeric_constants</span> <span class="kn">import</span> <span class="n">BASE_PRECISION</span><span class="p">,</span> <span class="n">PRICE_PRECISION</span>

<span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># place order to long 1 SOL-PERP @ $21.88 (post only)
</span><span class="n">order_params</span> <span class="o">=</span> <span class="n">OrderParams</span><span class="p">(</span>
            <span class="n">order_type</span><span class="o">=</span><span class="n">OrderType</span><span class="p">.</span><span class="n">Limit</span><span class="p">(),</span>
            <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">market_index</span><span class="o">=</span><span class="n">market_index</span><span class="p">,</span>
            <span class="n">direction</span><span class="o">=</span><span class="n">PositionDirection</span><span class="p">.</span><span class="n">Long</span><span class="p">(),</span>
            <span class="n">price</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(</span><span class="mf">21.88</span><span class="p">),</span>
            <span class="n">post_only</span><span class="o">=</span><span class="n">PostOnlyParams</span><span class="p">.</span><span class="n">TryPostOnly</span><span class="p">(),</span>
        <span class="p">)</span>
<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">place_perp_order</span><span class="p">(</span><span class="n">order_params</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "orders": [{
        "marketIndex": 0,
        "marketType": "perp",
        "amount": 1.23,
        "price": 80.0,
        "postOnly": true,
        "orderType": "limit",
        "immediateOrCancel": false,
        "reduceOnly": false
    }]
   }'</span> <span class="se">\</span>
localhost:8080/v2/orders
</code></pre></div><h3 id='typescript-10'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>orderParams</td>
<td>The order params</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-10'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>order_params</td>
<td>The order params</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>

<p>The order type is set to PERP / Perp() by default.</p>
<h2 id='placing-spot-order'>Placing Spot Order</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">orderParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">LIMIT</span><span class="p">,</span>
  <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">LONG</span><span class="p">,</span>
  <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToSpotPrecision</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
  <span class="na">price</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">placeSpotOrder</span><span class="p">(</span><span class="nx">orderParams</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">market_index</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">order_params</span> <span class="o">=</span> <span class="n">OrderParams</span><span class="p">(</span>
            <span class="n">order_type</span><span class="o">=</span><span class="n">OrderType</span><span class="p">.</span><span class="n">Limit</span><span class="p">(),</span>
            <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_spot_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">market_index</span><span class="p">),</span>
            <span class="n">market_index</span><span class="o">=</span><span class="n">market_index</span><span class="p">,</span>
            <span class="n">direction</span><span class="o">=</span><span class="n">PositionDirection</span><span class="p">.</span><span class="n">Long</span><span class="p">(),</span>
            <span class="n">price</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
        <span class="p">)</span>

<span class="k">await</span> <span class="n">driftClient</span><span class="p">.</span><span class="n">place_spot_order</span><span class="p">(</span><span class="n">order_params</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "orders": [{
        "marketIndex": 0,
        "marketType": "spot",
        "amount": -1.23,
        "price": 80.0,
        "postOnly": true,
        "orderType": "limit",
        "immediateOrCancel": false,
        "reduceOnly": false
    }]
   }'</span> <span class="se">\</span>
localhost:8080/v2/orders
</code></pre></div><h3 id='typescript-11'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>orderParams</td>
<td>The order params</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-11'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>order_params</td>
<td>The order params</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>

<p>The order type is set to SPOT / Spot() by default.</p>
<h2 id='placing-multiple-orders'>Placing Multiple Orders</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">placeOrderParams</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">LIMIT</span><span class="p">,</span>
    <span class="na">marketType</span><span class="p">:</span> <span class="nx">MarketType</span><span class="p">.</span><span class="nx">PERP</span><span class="p">,</span>
    <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">LONG</span><span class="p">,</span>
    <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="na">price</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(</span><span class="mf">21.23</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">LIMIT</span><span class="p">,</span>
    <span class="na">marketType</span><span class="p">:</span> <span class="nx">MarketType</span><span class="p">.</span><span class="nx">PERP</span><span class="p">,</span>
    <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">SHORT</span><span class="p">,</span>
    <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="na">oraclePriceOffset</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(.</span><span class="mi">05</span><span class="p">).</span><span class="nx">toNumber</span><span class="p">(),</span>
  <span class="p">}</span>
<span class="p">];</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">placeOrders</span><span class="p">(</span><span class="nx">placeOrderParams</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">place_order_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">OrderParams</span><span class="p">(</span>
    <span class="n">order_type</span><span class="o">=</span><span class="n">OrderType</span><span class="p">.</span><span class="n">Limit</span><span class="p">(),</span>
    <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">market_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="n">PositionDirection</span><span class="p">.</span><span class="n">Long</span><span class="p">(),</span>
    <span class="n">market_type</span><span class="o">=</span><span class="n">MarketType</span><span class="p">.</span><span class="n">Perp</span><span class="p">(),</span>
    <span class="n">price</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(</span><span class="mf">21.23</span><span class="p">),</span>
  <span class="p">),</span>
   <span class="n">OrderParams</span><span class="p">(</span>
    <span class="n">order_type</span><span class="o">=</span><span class="n">OrderType</span><span class="p">.</span><span class="n">Limit</span><span class="p">(),</span>
    <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">market_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="n">PositionDirection</span><span class="p">.</span><span class="n">Short</span><span class="p">(),</span>
    <span class="n">market_type</span><span class="o">=</span><span class="n">MarketType</span><span class="p">.</span><span class="n">Perp</span><span class="p">(),</span>
    <span class="n">oracle_price_offset</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(.</span><span class="mi">05</span><span class="p">),</span>
  <span class="p">)</span>
<span class="p">]</span>

<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">place_orders</span><span class="p">(</span><span class="n">place_order_params</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
      "orders": [{
          "marketIndex": 0,
          "marketType": "spot",
          "amount": 1.23,
          "price": 80.0,
          "postOnly": true,
          "orderType": "limit",
          "immediateOrCancel": false,
          "reduceOnly": false
      },
      {
          "marketIndex": 2,
          "marketType": "perp",
          "amount": 0.1,
          "price": 10000.0,
          "orderType": "market",
      }]
    }'</span> <span class="se">\</span>
localhost:8080/v2/orders
</code></pre></div><h3 id='typescript-12'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>placeOrderParams</td>
<td>Parameters for place order instructions</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-12'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>place_order_params</td>
<td>Parameters for place order instructions</td>
<td></td>
<td></td>
</tr>
</tbody></table>

<p>Placing multiple orders in one tx can be cheaper than placing them in separate tx.</p>
<h2 id='placing-oracle-market-orders'>Placing Oracle Market Orders</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">oraclePrice</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getOracleDataForPerpMarket</span><span class="p">(</span><span class="mi">18</span><span class="p">).</span><span class="nx">price</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">auctionStartPrice</span> <span class="o">=</span> <span class="nx">oraclePrice</span><span class="p">.</span><span class="nx">neg</span><span class="p">().</span><span class="nx">divn</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// start auction 10bps below oracle</span>
<span class="kd">const</span> <span class="nx">auctionEndPrice</span> <span class="o">=</span> <span class="nx">oraclePrice</span><span class="p">.</span><span class="nx">divn</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// end auction 10bps above oracle</span>
<span class="kd">const</span> <span class="nx">oraclePriceOffset</span> <span class="o">=</span> <span class="nx">oraclePrice</span><span class="p">.</span><span class="nx">divn</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span> <span class="c1">// limit price after auction 20bps above oracle</span>
<span class="kd">const</span> <span class="nx">auctionDuration</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span> <span class="c1">// 30 slots</span>
<span class="kd">const</span> <span class="nx">orderParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">ORACLE</span><span class="p">,</span>
  <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
  <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">LONG</span><span class="p">,</span>
  <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
  <span class="na">auctionStartPrice</span><span class="p">:</span> <span class="nx">auctionStartPrice</span><span class="p">,</span>
  <span class="na">auctionEndPrice</span><span class="p">:</span> <span class="nx">auctionEndPrice</span><span class="p">,</span>
  <span class="na">oraclePriceOffset</span><span class="p">:</span> <span class="nx">oraclePriceOffset</span><span class="p">,</span>
  <span class="na">auctionDuration</span><span class="p">:</span> <span class="nx">auctionDuration</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">placePerpOrder</span><span class="p">(</span><span class="nx">orderParams</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">oracle_price</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_oracle_price_data_for_perp_market</span><span class="p">(</span><span class="mi">18</span><span class="p">).</span><span class="n">price</span>
<span class="n">auction_start_price</span> <span class="o">=</span> <span class="o">-</span><span class="n">oracle_price</span> <span class="o">//</span> <span class="mi">1000</span> <span class="c1"># start auction 10bps below oracle
</span><span class="n">auction_end_price</span> <span class="o">=</span> <span class="n">oracle_price</span> <span class="o">//</span> <span class="mi">1000</span> <span class="c1"># end auction 10bps above oracle
</span><span class="n">oracle_price_offset</span> <span class="o">=</span> <span class="n">oracle_price</span> <span class="o">//</span> <span class="mi">500</span> <span class="c1"># limit price after auction 20bps above oracle
</span><span class="n">auction_duration</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># 30 slots
</span><span class="n">order_params</span> <span class="o">=</span> <span class="n">OrderParams</span><span class="p">(</span>
  <span class="n">order_type</span><span class="o">=</span><span class="n">OrderType</span><span class="p">.</span><span class="n">Oracle</span><span class="p">(),</span>
  <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
  <span class="n">market_index</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
  <span class="n">direction</span><span class="o">=</span><span class="n">PositionDirection</span><span class="p">.</span><span class="n">Long</span><span class="p">(),</span>
  <span class="n">auction_start_price</span><span class="o">=</span><span class="n">auction_start_price</span><span class="p">,</span>
  <span class="n">auction_end_price</span><span class="o">=</span><span class="n">auction_end_price</span><span class="p">,</span>
  <span class="n">oracle_price_offset</span><span class="o">=</span><span class="n">oracle_price_offset</span><span class="p">,</span>
  <span class="n">auction_duration</span><span class="o">=</span><span class="n">auction_duration</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">place_perp_order</span><span class="p">(</span><span class="n">order_params</span><span class="p">)</span>
</code></pre></div>
<p>Oracle market orders enable a user to define their auction params as an offset (or relative to) the oracle price.</p>
<h2 id='canceling-order'>Canceling Order</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">orderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">cancelOrder</span><span class="p">(</span><span class="nx">orderId</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">order_dd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">cancel_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">);</span>
</code></pre></div><h3 id='typescript-13'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>orderId</td>
<td>The order being canceled</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-13'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>order_id</td>
<td>The order being canceled</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>sub_account_id</td>
<td>Sub account to cancel order under</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>
<div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> DELETE <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{ "ids": [1] }'</span> <span class="se">\</span>
  localhost:8080/v2/orders
</code></pre></div><h2 id='canceling-order-by-user-order-id'>Canceling Order By User Order Id</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">userOrderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">cancelOrderByUserOrderId</span><span class="p">(</span><span class="nx">userOrderId</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">const</span> <span class="n">user_order_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">cancel_order_by_user_order_id</span><span class="p">(</span><span class="n">user_order_id</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> DELETE <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{ "userIds": [1] }'</span> <span class="se">\</span>
  localhost:8080/v2/orders
</code></pre></div><h3 id='typescript-14'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>userOrderId</td>
<td>Unique order id specified by user when order was placed</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-14'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>user_order_id</td>
<td>Unique order id specified by user when order was placed</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>sub_account_id</td>
<td>Sub account to cancel orders under</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>
<h2 id='cancel-orders'>Cancel Orders</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">marketType</span> <span class="o">=</span> <span class="nx">MarketType</span><span class="p">.</span><span class="nx">PERP</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">direction</span> <span class="o">=</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">LONG</span><span class="p">;</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">cancelOrders</span><span class="p">(</span><span class="nx">marketType</span><span class="p">,</span> <span class="nx">marketIndex</span><span class="p">,</span> <span class="nx">direction</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_type</span> <span class="o">=</span> <span class="n">MarketType</span><span class="p">.</span><span class="n">Perp</span><span class="p">()</span>
<span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">direction</span> <span class="o">=</span> <span class="n">PositionDirection</span><span class="p">.</span><span class="n">Long</span><span class="p">()</span>
<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">cancel_orders</span><span class="p">(</span><span class="n">market_type</span><span class="p">,</span> <span class="n">market_index</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span> <span class="c1"># cancel bids in perp market 0
</span>
<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">cancel_orders</span><span class="p">()</span> <span class="c1"># cancels all orders
</span></code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> DELETE <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{ "marketIndex": 1, "marketType": "spot" }'</span> <span class="se">\</span>
  localhost:8080/v2/orders
</code></pre></div><h3 id='typescript-15'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketType</td>
<td>The market type of orders to cancel. Must be set if marketIndex set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The market index of orders to cancel. Must be set if marketType set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>direction</td>
<td>The direction of orders to cancel.</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-15'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_type</td>
<td>The market type of orders to cancel</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>market_index</td>
<td>The market index of orders to cancel</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>direction</td>
<td>The direction  of orders to cancel</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>sub_account_id</td>
<td>The sub account from which to cancel orders</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>

<p>To cancel all orders, do not set any parameters.</p>
<h2 id='cancel-and-place-orders'>Cancel and Place Orders</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">cancelOrderParams</span> <span class="o">=</span> <span class="p">{</span>
   <span class="na">marketType</span><span class="p">:</span> <span class="nx">MarketType</span><span class="p">.</span><span class="nx">PERP</span><span class="p">,</span>
   <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">placeOrderParams</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
    <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">LIMIT</span><span class="p">,</span>
    <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">LONG</span><span class="p">,</span>
    <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="na">price</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(</span><span class="mf">21.23</span><span class="p">),</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">orderType</span><span class="p">:</span> <span class="nx">OrderType</span><span class="p">.</span><span class="nx">LIMIT</span><span class="p">,</span>
    <span class="na">marketIndex</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">direction</span><span class="p">:</span> <span class="nx">PositionDirection</span><span class="p">.</span><span class="nx">SHORT</span><span class="p">,</span>
    <span class="na">baseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="na">oraclePriceOffset</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPricePrecision</span><span class="p">(.</span><span class="mi">05</span><span class="p">).</span><span class="nx">toNumber</span><span class="p">(),</span>
  <span class="p">}</span>
<span class="p">];</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">cancelAndPlaceOrders</span><span class="p">(</span><span class="nx">cancelOrderParams</span><span class="p">,</span> <span class="nx">placeOrderParams</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">canel_order_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">MarketType</span><span class="p">.</span><span class="n">Perp</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="c1"># cancel all orders in perp market 0
</span><span class="n">place_order_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">OrderParams</span><span class="p">(</span>
    <span class="n">order_type</span><span class="o">=</span><span class="n">OrderType</span><span class="p">.</span><span class="n">Limit</span><span class="p">(),</span>
    <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">market_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="n">PositionDirection</span><span class="p">.</span><span class="n">Long</span><span class="p">(),</span>
    <span class="n">market_type</span><span class="o">=</span><span class="n">MarketType</span><span class="p">.</span><span class="n">Perp</span><span class="p">(),</span>
    <span class="n">price</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(</span><span class="mf">21.23</span><span class="p">),</span>
  <span class="p">),</span>
   <span class="n">OrderParams</span><span class="p">(</span>
    <span class="n">order_type</span><span class="o">=</span><span class="n">OrderType</span><span class="p">.</span><span class="n">Limit</span><span class="p">(),</span>
    <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">market_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="n">PositionDirection</span><span class="p">.</span><span class="n">Short</span><span class="p">(),</span>
    <span class="n">market_type</span><span class="o">=</span><span class="n">MarketType</span><span class="p">.</span><span class="n">Perp</span><span class="p">(),</span>
    <span class="n">oracle_price_offset</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(.</span><span class="mi">05</span><span class="p">),</span>
  <span class="p">)</span>
<span class="p">]</span>

<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">cancel_and_place_orders</span><span class="p">(</span><span class="n">canel_order_params</span><span class="p">,</span> <span class="n">place_order_params</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
<span class="nt">-d</span> <span class="s1">'{
      "cancel": {
        "marketIndex": 0,
        "marketType": "perp"
      },
      "place": {
        "orders": [{
            "marketIndex": 0,
            "marketType": "perp",
            "amount": -1.23,
            "price": 80.0,
            "postOnly": true,
            "orderType": "limit",
            "immediateOrCancel": false,
            "reduceOnly": false
        }]
      }
   }'</span> <span class="se">\</span>
localhost:8080/v2/orders/cancelAndPlace
</code></pre></div><h3 id='typescript-16'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>cancelOrderParams</td>
<td>Parameters for cancel orders instruction</td>
<td></td>
<td></td>
</tr>
<tr>
<td>placeOrderParams</td>
<td>Parameters for place order instructions</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-16'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>cancel_params</td>
<td>Tuple with optional MarketType, market index, and PositionDirection for canceling orders</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>place_order_params</td>
<td>List of OrderParams for placing new orders</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>sub_account_id</td>
<td>The sub account to use</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>

<p>To cancel all orders, do not set any parameters.</p>
<h2 id='modify-order-params'>Modify Order Params</h2><h3 id='typescript-17'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>orderId</td>
<td>The order id of order to modify</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>baseAssetAmount</td>
<td>The amount of base asset to buy or sell</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>direction</td>
<td>The direction of order e.g. long (bid) or short (ask)</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>limitPrice</td>
<td>The limit price for order</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>reduceOnly</td>
<td>If the order can only reduce positions</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>postOnly</td>
<td>If the order can only be a maker</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>triggerPrice</td>
<td>at what price order is triggered. only applicable for triggerMarket and triggerLimit orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>triggerCondition</td>
<td>whether order is triggered above or below triggerPrice. only applicable for triggerMarket and triggerLimit orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>oraclePriceOffset</td>
<td>priceOffset for oracle derived limit price. only applicable for limit and oracle orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>auctionDuration</td>
<td>how many slots the auction lasts. only applicable for market and oracle orders</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>auctionStartPrice</td>
<td>the price the auction starts at</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>auctionEndPrice</td>
<td>the price the auction ends at</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>maxTs</td>
<td>the max timestamp before the order expires</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-17'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>direction</td>
<td>The direction of the order</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>base_asset_amount</td>
<td>Amount of base asset to buy or sell</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>price</td>
<td>Limit price for the order</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>reduce_only</td>
<td>If the order should only reduce positions</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>post_only</td>
<td>If the order should only be a maker order</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>immediate_or_cancel</td>
<td>Whether the order is immediate or cancel</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>max_ts</td>
<td>Max timestamp for order expiry</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>trigger_price</td>
<td>Trigger price for trigger orders</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>trigger_condition</td>
<td>Condition for triggering the order</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>oracle_price_offset</td>
<td>Offset for oracle-derived limit price</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>auction_duration</td>
<td>Duration of the auction in slots</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>auction_start_price</td>
<td>Starting price of the auction</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>auction_end_price</td>
<td>Ending price of the auction</td>
<td>Yes</td>
<td>None</td>
</tr>
<tr>
<td>policy</td>
<td>Policy for modifying the order</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>
<h2 id='modifying-order'>Modifying Order</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">updateParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">orderId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">newBaseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">modifyOrder</span><span class="p">(</span><span class="nx">orderParams</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">order_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">modify_order_params</span> <span class="o">=</span> <span class="n">ModifyOrderParams</span><span class="p">(</span>
  <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="n">price</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">modify_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">modify_order_params</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> PATCH <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "orders": [{
        "orderId": 32,
        "amount": 1.05,
        "price": 61.0
    }]
   }'</span> <span class="se">\</span>
localhost:8080/v2/orders
</code></pre></div><h3 id='typescript-18'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>orderId</td>
<td>The order id of order to modify</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>modifyOrderParams</td>
<td>The modify order params</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-18'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>order_id</td>
<td>The order ID of the order to modify</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>modify_order_params</td>
<td>The parameters for modifying the order</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>sub_account_id</td>
<td>The sub account to use</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>

<p>Modify cancels and places a new order</p>

<p>For typescript, the orderId and modifyOrderParams are merged into a single object and some properties are prefixed with <code>new</code> e.g. <code>newBaseAssetAmount</code></p>
<h2 id='modifying-order-by-user-order-id'>Modifying Order By User Order Id</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">updateParams</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">userOrderId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">newBaseAssetAmount</span><span class="p">:</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">convertToPerpPrecision</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">modifyOrderByUserOrderId</span><span class="p">(</span><span class="nx">orderParams</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">user_order_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">modify_order_params</span> <span class="o">=</span> <span class="n">ModifyOrderParams</span><span class="p">(</span>
  <span class="n">base_asset_amount</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_perp_precision</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="n">price</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">convert_to_price_precision</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">modify_order_by_user_id</span><span class="p">(</span><span class="n">user_order_id</span><span class="p">,</span> <span class="n">modify_order_params</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> PATCH <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{
    "orders": [{
        "userOrderId": 69,
        "amount": 1.05,
        "price": 61.0
    }]
   }'</span> <span class="se">\</span>
localhost:8080/v2/orders
</code></pre></div><h3 id='typescript-19'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>userOrderId</td>
<td>The user order id of order to modify</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>modifyOrderParams</td>
<td>The modify order params</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-19'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>user_order_id</td>
<td>The user order ID of the order to modify</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>modify_order_params</td>
<td>The parameters for modifying the order</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>sub_account_id</td>
<td>The sub-account ID associated with the order</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>

<p>Modify cancels and places a new order</p>

<p>For typescript, the userOrderId and modifyOrderParams are merged into a single object and some properties are prefixed with <code>new</code> e.g. <code>newBaseAssetAmount</code></p>
<h2 id='settle-perp-pnl'>Settle Perp PNL</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span>  <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getUser</span><span class="p">();</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">settlePNL</span><span class="p">(</span>
   <span class="nx">user</span><span class="p">.</span><span class="nx">userAccountPublicKey</span><span class="p">,</span>
   <span class="nx">user</span><span class="p">.</span><span class="nx">getUserAccount</span><span class="p">(),</span>
   <span class="nx">marketIndex</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">user</span> <span class="o">=</span>  <span class="n">drift_client</span><span class="p">.</span><span class="n">get_user</span><span class="p">()</span>
<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">settle_pnl</span><span class="p">(</span>
   <span class="n">user</span><span class="p">.</span><span class="n">user_public_key</span><span class="p">,</span>
   <span class="n">user</span><span class="p">.</span><span class="n">get_user_account</span><span class="p">(),</span>
   <span class="n">market_index</span>
<span class="p">)</span>
</code></pre></div><h3 id='typescript-20'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>settleeUserAccountPublicKey</td>
<td>User address you&#39;re settling pnl for</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>settleeUserAccount</td>
<td>User account data you&#39;re settling pnl for</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>Market index for the perp market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-20'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>settlee_user_account_public_key</td>
<td>Public key of the user account to settle PNL for</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>settlee_user_account</td>
<td>User account data for PNL settlement</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>market_index</td>
<td>Index of the perpetual market for PNL settlement</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-spot-market-account'>Get Spot Market Account</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">spotMarketAccount</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getSpotMarketAccount</span><span class="p">(</span><span class="nx">marketIndex</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">spot_market_account</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_spot_market_account</span><span class="p">(</span><span class="n">market_index</span><span class="p">);</span>
</code></pre></div><h3 id='typescript-21'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketIndex</td>
<td>The market index for the spot market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-21'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_index</td>
<td>The market index for the spot market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-perp-market-account'>Get Perp Market Account</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">perpMarketAccount</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getPerpMarketAccount</span><span class="p">(</span><span class="nx">marketIndex</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="n">perp_market_account</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_perp_market_account</span><span class="p">(</span><span class="n">market_index</span><span class="p">);</span>
</code></pre></div><h3 id='typescript-22'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketIndex</td>
<td>The market index for the perp market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-22'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_index</td>
<td>The market index for the perp market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h1 id='user'>User</h1><h2 id='get-user'>Get User</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>   <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getUser</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="n">user</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_user</span><span class="p">();</span>
</code></pre></div><h3 id='typescript-23'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>subAccountId</td>
<td>The sub account id of user to get</td>
<td>Yes</td>
<td>active sub account</td>
</tr>
<tr>
<td>authority</td>
<td>The authority of user to get. Only necessary if using multiple delegate accounts</td>
<td>Yes</td>
<td>current authority</td>
</tr>
</tbody></table>
<h3 id='python-23'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>sub_account_id</td>
<td>The sub account id of user to get</td>
<td>Yes</td>
<td>active sub account</td>
</tr>
</tbody></table>
<h2 id='getting-deposit-borrow-amounts'>Getting Deposit/Borrow Amounts</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">tokenAmount</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getTokenAmount</span><span class="p">(</span>
  <span class="nx">marketIndex</span><span class="p">,</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">isDeposit</span> <span class="o">=</span> <span class="nx">tokenAmount</span><span class="p">.</span><span class="nx">gte</span><span class="p">(</span><span class="k">new</span> <span class="nx">BN</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">isBorrow</span> <span class="o">=</span> <span class="nx">tokenAmount</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="k">new</span> <span class="nx">BN</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">token_amount</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_token_amount</span><span class="p">(</span><span class="n">marketIndex</span><span class="p">)</span>

<span class="n">is_deposit</span> <span class="o">=</span> <span class="n">token_amount</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">is_borrow</span> <span class="o">=</span> <span class="n">token_amount</span> <span class="o">&lt;</span> <span class="mi">0</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code> curl <span class="nt">-X</span> GET <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{"marketIndex":0,"marketType":"spot"}'</span> <span class="se">\</span>
localhost:8080/v2/positions
</code></pre></div><h3 id='typescript-24'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketIndex</td>
<td>Market index for the spot market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-24'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_index</td>
<td>Market index for the spot market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>

<p>If token amount is greater than 0, it is a deposit. If less than zero, it is a borrow.</p>
<h2 id='get-perp-position'>Get Perp Position</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">baseAssetAmount</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getPerpPosition</span><span class="p">(</span>
  <span class="nx">marketIndex</span><span class="p">,</span>
<span class="p">)?.</span><span class="nx">baseAssetAmount</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">isLong</span> <span class="o">=</span> <span class="nx">baseAssetAmount</span><span class="p">.</span><span class="nx">gte</span><span class="p">(</span><span class="k">new</span> <span class="nx">BN</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">isShort</span> <span class="o">=</span> <span class="nx">baseAssetAmount</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="k">new</span> <span class="nx">BN</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">perp_position</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_perp_position</span><span class="p">(</span><span class="n">market_index</span><span class="p">)</span>

<span class="n">base_asset_amount</span> <span class="o">=</span> <span class="n">perp_position</span><span class="p">.</span><span class="n">base_asset_amount</span> <span class="k">if</span> <span class="n">perp_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="mi">0</span>

<span class="n">is_long</span> <span class="o">=</span> <span class="n">base_asset_amount</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">is_short</span> <span class="o">=</span> <span class="n">base_asset_amount</span> <span class="o">&lt;</span> <span class="mi">0</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="nt">-X</span> GET <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{"marketIndex":0,"marketType":"perp"}'</span> <span class="se">\</span>
localhost:8080/v2/positions
</code></pre></div><h3 id='typescript-25'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketIndex</td>
<td>Market index for the perp market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-25'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_index</td>
<td>Market index for the perp market</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>

<p>If base amount is greater than 0, it is a long. If less than zero, it is a short.</p>
<h2 id='get-order'>Get Order</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">orderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">order</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getOrder</span><span class="p">(</span>
  <span class="nx">orderId</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">order_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">order</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
</code></pre></div><h3 id='typescript-26'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>orderId</td>
<td>Order id for the order you&#39;re getting</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-26'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>order_id</td>
<td>Order id for the order you&#39;re getting</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-order-by-user-order-id'>Get Order By User Order Id</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">userOrderId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">order</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getOrderByUserOrderId</span><span class="p">(</span>
  <span class="nx">userOrderId</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">user_order_id</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">order</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_order_by_user_order_id</span><span class="p">(</span><span class="n">user_order_id</span><span class="p">)</span>
</code></pre></div><h3 id='typescript-27'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>userOrderId</td>
<td>User order id for the order you&#39;re getting</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-27'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>user_order_id</td>
<td>User order id for the order you&#39;re getting</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-open-orders'>Get Open Orders</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">orders</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getOpenOrders</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">orders</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_open_orders</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl localhost:8080/v2/orders
</code></pre></div><h2 id='get-unrealized-perp-pnl'>Get Unrealized Perp Pnl</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>  <span class="kd">const</span> <span class="nx">pnl</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getUnrealizedPNL</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="n">pnl</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_unrealized_pnl</span><span class="p">()</span>
</code></pre></div><h3 id='typescript-28'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>withFunding</td>
<td>Whether to include unsettled funding payments</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>marketIndex</td>
<td>Index of a specific market for PNL calculation</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>withWeightMarginCategory</td>
<td>To include margin category weighting in PNL calculation</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>strict</td>
<td>Whether the calculation should be strict</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='python-28'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>with_funding</td>
<td>Whether to include unsettled funding payments</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>market_index</td>
<td>Index of a specific market for PNL calculation</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>with_weight_margin_category</td>
<td>To include margin category weighting in PNL calculation</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>strict</td>
<td>Whether the calculation should be strict</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>
<h2 id='get-unrealized-funding-pnl'>Get Unrealized Funding Pnl</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>  <span class="kd">const</span> <span class="nx">pnl</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getUnrealizedFundingPNL</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="n">pnl</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_unrealized_funding_pnl</span><span class="p">()</span>
</code></pre></div><h3 id='typescript-29'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketIndex</td>
<td>Whether to only return pnl for specific market</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h3 id='python-29'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_index</td>
<td>Whether to only return pnl for specific market</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-total-collateral'>Get Total Collateral</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>  <span class="kd">const</span> <span class="nx">totalCollateral</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getTotalCollateral</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="n">total_collateral</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_total_collateral</span><span class="p">()</span>
</code></pre></div><h3 id='typescript-30'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marginCategory</td>
<td>Initial or Maintenance</td>
<td>Yes</td>
<td>Initial</td>
</tr>
<tr>
<td>strict</td>
<td>Whether the calculation should be strict</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='python-30'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>margin_category</td>
<td>Initial or Maintenance</td>
<td>Yes</td>
<td>Initial</td>
</tr>
<tr>
<td>strict</td>
<td>Whether the calculation should be strict</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>

<p>Asset weights vary based on whether you&#39;re checking the initial or maintenance margin requirement. Initial is used for initial leverage extension, maintenance for determining liquidations.</p>
<h2 id='get-margin-requirement'>Get Margin Requirement</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>  <span class="kd">const</span> <span class="nx">marginRequirement</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getMarginRequirement</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="n">margin_requirement</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_margin_requirement</span><span class="p">()</span>
</code></pre></div><h3 id='typescript-31'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marginCategory</td>
<td>The type of margin (Initial or Maintenance)</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>liquidationBuffer</td>
<td>Buffer value for liquidation calculation</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>strict</td>
<td>Whether the calculation should be strict</td>
<td>Yes</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='python-31'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>margin_category</td>
<td>Type of margin, either Initial or Maintenance</td>
<td>Yes</td>
<td>MarginCategory.INITIAL</td>
</tr>
<tr>
<td>liquidation_buffer</td>
<td>Additional buffer value for liquidation calculation</td>
<td>Yes</td>
<td>0</td>
</tr>
<tr>
<td>strict</td>
<td>Whether the calculation should be strict</td>
<td>Yes</td>
<td>False</td>
</tr>
</tbody></table>

<p>Liability weights (for borrows) and margin ratios (for perp positions) vary based on whether you&#39;re checking the initial or maintenance margin requirement. Initial is used for initial leverage extension, maintenance for determining liquidations.</p>
<h2 id='get-free-collateral'>Get Free Collateral</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>  <span class="kd">const</span> <span class="nx">freeCollateral</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getFreeCollateral</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="n">free_collateral</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_free_collateral</span><span class="p">()</span>
</code></pre></div><h3 id='typescript-32'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marginCategory</td>
<td>Initial or Maintenance</td>
<td>Yes</td>
<td>Initial</td>
</tr>
</tbody></table>
<h3 id='python-32'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marginCategory</td>
<td>Type of margin, either Initial or Maintenance</td>
<td>Yes</td>
<td>MarginCategory.INITIAL</td>
</tr>
</tbody></table>

<p>Free collateral is the difference between your total collateral and your margin requirement.</p>
<h2 id='get-leverage'>Get Leverage</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>  <span class="kd">const</span> <span class="nx">leverage</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getLeverage</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="n">leverage</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">get_leverage</span><span class="p">()</span>
</code></pre></div><h3 id='typescript-33'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>includeOpenOrders</td>
<td>Whether to factor in open orders in position size</td>
<td>Yes</td>
<td>true</td>
</tr>
</tbody></table>
<h3 id='python-33'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>include_open_orders</td>
<td>Whether to factor in open orders in position size</td>
<td>Yes</td>
<td>True</td>
</tr>
</tbody></table>

<p>Leverage is the total liability value (borrows plus total perp position) divided by net asset value (total assets plus total liabilities)</p>
<h1 id='events'>Events</h1><h2 id='event-subscription'>Event Subscription</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">import</span> <span class="p">{</span><span class="nx">EventSubscriber</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@drift-labs/sdk</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">eventTypes</span><span class="p">:</span> <span class="p">[</span>
    <span class="dl">'</span><span class="s1">DepositRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">FundingPaymentRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">LiquidationRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">OrderRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">OrderActionRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">FundingRateRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">NewUserRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">SettlePnlRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">LPRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">InsuranceFundRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">SpotInterestRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">InsuranceFundStakeRecord</span><span class="dl">'</span><span class="p">,</span>
    <span class="dl">'</span><span class="s1">CurveRecord</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">maxTx</span><span class="p">:</span> <span class="mi">4096</span><span class="p">,</span>
  <span class="na">maxEventsPerType</span><span class="p">:</span> <span class="mi">4096</span><span class="p">,</span>
  <span class="na">orderBy</span><span class="p">:</span> <span class="dl">'</span><span class="s1">blockchain</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">orderDir</span><span class="p">:</span> <span class="dl">'</span><span class="s1">asc</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">commitment</span><span class="p">:</span> <span class="dl">'</span><span class="s1">confirmed</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">logProviderConfig</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">websocket</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">eventSubscriber</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventSubscriber</span><span class="p">(</span><span class="nx">connection</span><span class="p">,</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">program</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="k">await</span> <span class="nx">eventSubscriber</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>

<span class="nx">eventSubscriber</span><span class="p">.</span><span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">newEvent</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">driftpy.events.event_subscriber</span> <span class="kn">import</span> <span class="n">EventSubscriber</span>
<span class="kn">from</span> <span class="nn">driftpy.events.types</span> <span class="kn">import</span> <span class="n">WrappedEvent</span><span class="p">,</span> <span class="n">EventSubscriptionOptions</span><span class="p">,</span> <span class="n">WebsocketLogProviderConfig</span>

<span class="n">options</span> <span class="o">=</span> <span class="n">EventSubscriptionOptions</span><span class="p">(</span>
    <span class="n">event_types</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">'DepositRecord'</span><span class="p">,</span>
        <span class="s">'FundingPaymentRecord'</span><span class="p">,</span>
        <span class="s">'LiquidationRecord'</span><span class="p">,</span>
        <span class="s">'OrderRecord'</span><span class="p">,</span>
        <span class="s">'OrderActionRecord'</span><span class="p">,</span>
        <span class="s">'FundingRateRecord'</span><span class="p">,</span>
        <span class="s">'NewUserRecord'</span><span class="p">,</span>
        <span class="s">'SettlePnlRecord'</span><span class="p">,</span>
        <span class="s">'LPRecord'</span><span class="p">,</span>
        <span class="s">'InsuranceFundRecord'</span><span class="p">,</span>
        <span class="s">'SpotInterestRecord'</span><span class="p">,</span>
        <span class="s">'InsuranceFundStakeRecord'</span><span class="p">,</span>
        <span class="s">'CurveRecord'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">max_tx</span><span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
    <span class="n">max_events_per_type</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
    <span class="n">order_by</span><span class="o">=</span><span class="s">"blockchain"</span><span class="p">,</span>
    <span class="n">order_dir</span><span class="o">=</span><span class="s">"asc"</span><span class="p">,</span>
    <span class="n">commitment</span><span class="o">=</span><span class="s">"processed"</span><span class="p">,</span>
    <span class="n">log_provider_config</span><span class="o">=</span><span class="n">WebsocketLogProviderConfig</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">event_subscriber</span> <span class="o">=</span> <span class="n">EventSubscriber</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">program</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<span class="n">event_subscriber</span><span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>

<span class="n">event_subscriber</span><span class="p">.</span><span class="n">event_emitter</span><span class="p">.</span><span class="n">new_event</span> <span class="o">+=</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</code></pre></div><h3 id='typescript-34'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>connection</td>
<td>Connection object specifying solana rpc url</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>program</td>
<td>Anchor program object used to deserialize events from transaction logs</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>options.eventTypes</td>
<td>Which events types to trigger event callbacks for</td>
<td>Yes</td>
<td>All events</td>
</tr>
<tr>
<td>options.maxTx</td>
<td>Max number of transactions to keep in memory</td>
<td>Yes</td>
<td>4096</td>
</tr>
<tr>
<td>options.maxEventsPerType</td>
<td>Max number of events per event type to keep in memory</td>
<td>Yes</td>
<td>4096</td>
</tr>
<tr>
<td>options.orderBy</td>
<td>Whether to sort the tx in memory by the order they occurred on chain (&#39;blockchain&#39;) or received by client (&#39;client&#39;)</td>
<td>Yes</td>
<td>&#39;blockchain&#39;</td>
</tr>
<tr>
<td>options.orderDir</td>
<td>Whether to sort the tx in memory to be most recent (&#39;desc&#39;) or oldest (&#39;asc&#39;)</td>
<td>Yes</td>
<td>&#39;asc&#39;</td>
</tr>
<tr>
<td>options.commitment</td>
<td>What transaction commitment to wait for</td>
<td>Yes</td>
<td>&#39;confirmed&#39;</td>
</tr>
<tr>
<td>options.logProviderConfig</td>
<td>Whether to use websocket or polling to listen for tx logs</td>
<td>Yes</td>
<td>{type: &quot;websocket&quot;}</td>
</tr>
<tr>
<td>options.address</td>
<td>Which address to listen to events for. Defaults to drift program.</td>
<td>Yes</td>
<td>dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH</td>
</tr>
</tbody></table>
<h3 id='python-34'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>connection</td>
<td>AsyncClient object specifying Solana RPC URL</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>program</td>
<td>Anchor program object used to deserialize events from transaction logs</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>options</td>
<td>Configuration options for event subscription</td>
<td>Yes</td>
<td>EventSubscriptionOptions.default()</td>
</tr>
<tr>
<td>- address</td>
<td>Address to listen to events for, defaults to Drift program</td>
<td>Yes</td>
<td>DRIFT_PROGRAM_ID</td>
</tr>
<tr>
<td>- event_types</td>
<td>Types of events to trigger event callbacks for</td>
<td>Yes</td>
<td>DEFAULT_EVENT_TYPES</td>
</tr>
<tr>
<td>- max_events_per_type</td>
<td>Maximum number of events per event type to keep in memory</td>
<td>Yes</td>
<td>4096</td>
</tr>
<tr>
<td>- order_by</td>
<td>Sort order of transactions, by &#39;blockchain&#39; order or &#39;client&#39; received order</td>
<td>Yes</td>
<td>&quot;blockchain&quot;</td>
</tr>
<tr>
<td>- order_dir</td>
<td>Sorting direction, either most recent (&#39;desc&#39;) or oldest (&#39;asc&#39;)</td>
<td>Yes</td>
<td>&quot;asc&quot;</td>
</tr>
<tr>
<td>- commitment</td>
<td>Transaction commitment level to wait for</td>
<td>Yes</td>
<td>&quot;confirmed&quot;</td>
</tr>
<tr>
<td>- max_tx</td>
<td>Maximum number of transactions to keep in memory</td>
<td>Yes</td>
<td>4096</td>
</tr>
<tr>
<td>- log_provider_config</td>
<td>Configuration for log provider, either websocket or polling</td>
<td>Yes</td>
<td>WebsocketLogProviderConfig()</td>
</tr>
<tr>
<td>- until_tx</td>
<td>Signature to listen until, used for log provider</td>
<td>Yes</td>
<td>None</td>
</tr>
</tbody></table>

<p>Protocol events are recorded in transactions logs. To listen for events, one must subscribe to the drift program&#39;s transaction logs.</p>
<h2 id='event-types'>Event Types</h2>
<table><thead>
<tr>
<th>Event Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>DepositRecord</td>
<td>A record of a user depositing or withdrawing funds from protocol</td>
</tr>
<tr>
<td>FundingPaymentRecord</td>
<td>A record of a user paying/receiving funding payments</td>
</tr>
<tr>
<td>LiquidationRecord</td>
<td>A record of a user being liquidated</td>
</tr>
<tr>
<td>OrderRecord</td>
<td>A record of a user placing an order, including all of its parameters</td>
</tr>
<tr>
<td>OrderActionRecord</td>
<td>A record of a user action on an order, including place, cancel and fill</td>
</tr>
<tr>
<td>FundingRateRecord</td>
<td>A record of the funding rate changing</td>
</tr>
<tr>
<td>NewUserRecord</td>
<td>A record of a new user</td>
</tr>
<tr>
<td>SettlePnlRecord</td>
<td>A record of a user settling their pnl</td>
</tr>
<tr>
<td>LPRecord</td>
<td>A record of a user adding or removing passive perp liquidity</td>
</tr>
<tr>
<td>InsuranceFundRecord</td>
<td>A record of the insurance fund changing</td>
</tr>
<tr>
<td>SpotInterestRecord</td>
<td>A record of the spot interest changing</td>
</tr>
<tr>
<td>InsuranceFundStakeRecord</td>
<td>A record of a user staking or unstaking from the insurance fund</td>
</tr>
<tr>
<td>CurveRecord</td>
<td>A record of the amm curve updating</td>
</tr>
</tbody></table>
<h2 id='listening-to-perp-market-fills'>Listening to Perp Market Fills</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">marketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">isPerpMarketFill</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">eventType</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">OrderActionRecord</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">marketIndex</span> <span class="o">!==</span> <span class="nx">marketIndex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isVariant</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">marketType</span><span class="p">,</span> <span class="dl">'</span><span class="s1">perp</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isVariant</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">action</span><span class="p">,</span> <span class="dl">'</span><span class="s1">fill</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">fillCallback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">eventSubscriber</span><span class="p">.</span><span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">newEvent</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isPerpMarketFill</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">fillCallback</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">market_index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">fill_callback</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">WrappedEvent</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">event_type</span> <span class="o">!=</span> <span class="s">"OrderActionRecord"</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">market_index</span> <span class="o">!=</span> <span class="n">market_index</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_variant</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">market_type</span><span class="p">,</span> <span class="s">"Perp"</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_variant</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">action</span><span class="p">,</span> <span class="s">"Fill"</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>


<span class="n">event_subscriber</span><span class="p">.</span><span class="n">event_emitter</span><span class="p">.</span><span class="n">new_event</span> <span class="o">+=</span> <span class="n">fill_callback</span>
</code></pre></div><h2 id='listening-to-user-fills'>Listening to User Fills</h2><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">options</span> <span class="o">=</span> <span class="n">EventSubscriptionOptions</span><span class="p">(</span>
    <span class="n">address</span><span class="o">=</span><span class="n">drift_client</span><span class="p">.</span><span class="n">get_user_account_public_key</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">event_subscriber</span> <span class="o">=</span> <span class="n">EventSubscriber</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">program</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<span class="n">event_subscriber</span><span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">fill_callback</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">WrappedEvent</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">event_type</span> <span class="o">!=</span> <span class="s">"OrderActionRecord"</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_variant</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">action</span><span class="p">,</span> <span class="s">"Fill"</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="n">is_taker</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">taker</span> <span class="o">==</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_user_account_public_key</span><span class="p">()</span>
    <span class="n">is_maker</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">taker</span> <span class="o">==</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_user_account_public_key</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_taker</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_maker</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">print</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>


<span class="n">event_subscriber</span><span class="p">.</span><span class="n">event_emitter</span><span class="p">.</span><span class="n">new_event</span> <span class="o">+=</span> <span class="n">fill_callback</span>
</code></pre></div><h2 id='getting-events-received-by-type'>Getting Events Received By Type</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">eventType</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">OrderActionRecord</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">eventSubscriber</span><span class="p">.</span><span class="nx">getEventsReceived</span><span class="p">(</span><span class="nx">eventType</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">event_type</span> <span class="o">=</span> <span class="s">'OrderActionRecord'</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">event_subscriber</span><span class="p">.</span><span class="n">get_events_array</span><span class="p">(</span><span class="n">event_type</span><span class="p">)</span>
</code></pre></div>
<p>This returns all the events that the event subscriber currently has stored in memory.</p>
<h2 id='getting-events-by-transaction'>Getting Events By Transaction</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">txSig</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">3dq5PtQ3VnNTkQRrHhQ1nRACWZaFVvSBKs1RLXM8WvCqLHTzTuVGc7XER5awoLFLTdJ4kqZiNmo7e8b3pXaEGaoo</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">events</span> <span class="o">=</span> <span class="nx">eventSubscriber</span><span class="p">.</span><span class="nx">getEventsByTx</span><span class="p">(</span><span class="nx">txSig</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="n">tx_sig</span> <span class="o">=</span> <span class="s">'3dq5PtQ3VnNTkQRrHhQ1nRACWZaFVvSBKs1RLXM8WvCqLHTzTuVGc7XER5awoLFLTdJ4kqZiNmo7e8b3pXaEGaoo'</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">event_subscriber</span><span class="p">.</span><span class="n">get_events_by_tx</span><span class="p">(</span><span class="n">tx_sig</span><span class="p">)</span>
</code></pre></div>
<p>This returns the events that the event subscriber currently has stored in memory for a given transaction.</p>
<h1 id='margin-system'>Margin System</h1>
<p>Drift offers a cross-collateral margining system, allowing users to utilize multiple assets as trading collateral.</p>

<p>The margining system tracks each user&#39;s total collateral, the weighted sum of the user&#39;s deposits and perp pnl, as well
as their margin requirement, the weighted value out the user&#39;s outstanding borrow and perp positions.</p>

<p>Total collateral is calculated as:</p>

<p>\[\sum_{i=1}^n d_i \cdot p_i \cdot w_i^a\ +\ \sum_{j=1}^n pnl_j \cdot qp_j \cdot w_j^{pnl} \]</p>

<p>Where</p>

<ul>
<li>\(d_i\) is the deposit amount for spot market \(i\)</li>
<li>\(p_i\) is the price for spot market \(i\)</li>
<li>\(w_i^a\) is the asset weight for spot market \(i\)</li>
<li>\(pnl_j\) is the pnl for perp market \(j\)</li>
<li>\(qp_j\) is the quote asset price for perp market \(j\)</li>
<li>\(w_j^{pnl}\) is the pnl weight for perp market \(j\)</li>
</ul>

<p>Margin requirement is calculated as:</p>

<p>\[ \sum_{i=1}^n b_i \cdot p_i \cdot w_i^l\ +\ \sum_{j=1}^n ba_j \cdot o_j \cdot qp_j \cdot m_j \]</p>

<p>Where</p>

<ul>
<li>\(b_i\) is the borrow amount for spot market \(i\)</li>
<li>\(p_i\) is the price for spot market \(i\)</li>
<li>\(w_i^l\) is the liability weight for spot market \(i\)</li>
<li>\(ba_j\) is the base amount for perp market \(j\)</li>
<li>\(o_j\) is the price for perp/prediction market \(j\)</li>
<li>\(qp_j\) is the quote asset price for perp market \(j\)</li>
<li>\(m_j\) is the margin ratio for perp market \(j\)</li>
</ul>

<p>The weights and margin ratios depend on whether you&#39;re calculating the initial or maintenance values.</p>

<p>The initial maintenance check governs leverage extension. To open a new perp position or borrow, a user&#39;s initial total collateral must be greater than their initial margin requirement.</p>

<p>The maintenance check governs when a user&#39;s position must be liquidated. If a user&#39;s maintenance total collateral drops below their maintenance margin requirement, a user&#39;s position can be liquidated
to reduce their risk.</p>

<p>The prices used for deposits, borrows and perp quote assets differ between the initial and maintenance checks. The maintenance check uses
the current oracle price. The initial check uses the <code>min(oracle_price, oracle_twap)</code> for deposits and positive perp pnl and <code>max(oracle_price, oracle_twap)</code>
for borrows, negative perp pnl and perp base amount.</p>

<p>For prediction markets, the price used in the margin system depends on the direction of the position. For short positions (betting no), the margin system uses
1 - oracle price. For long position (betting yes), it uses the oracle price. This is the account for the user&#39;s worst case loss. E.g. if a user shorts at $.01,
their worst case loss is $.99.</p>
<h1 id='numerical-precisions'>Numerical Precisions</h1>
<p>To maintain numerical precision, the on-chain program stores all values as integers.</p>
<h2 id='getting-a-current-perp-position'>Getting a Current Perp Position</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">perpMarketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// SOL-PERP</span>
<span class="kd">const</span> <span class="nx">perpPosition</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getPerpPosition</span><span class="p">(</span><span class="nx">perpMarketIndex</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">convertToNumber</span><span class="p">(</span><span class="nx">perpPosition</span><span class="p">.</span><span class="nx">baseAssetAmount</span><span class="p">,</span> <span class="nx">BASE_PRECISION</span><span class="p">));</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">perp_market_index</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># SOL-PERP
</span><span class="n">perp_position</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_perp_position</span><span class="p">(</span><span class="n">market_index</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">convert_to_number</span><span class="p">(</span><span class="n">perp_position</span><span class="p">.</span><span class="n">base_asset_amount</span><span class="p">,</span> <span class="n">BASE_PRECISION</span><span class="p">))</span>
</code></pre></div>
<p>This prints the size of the current perp position in perp market index 0 (SOL-PERP)</p>
<h2 id='getting-a-current-spot-position'>Getting a Current Spot Position</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="kd">const</span> <span class="nx">spotMarketIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// USDC</span>
<span class="kd">const</span> <span class="nx">spotConfig</span> <span class="o">=</span> <span class="nx">SpotMarkets</span><span class="p">[</span><span class="dl">'</span><span class="s1">mainnet-beta</span><span class="dl">'</span><span class="p">][</span><span class="nx">spotMarketIndex</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">spotMarket</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getSpotMarketAccount</span><span class="p">(</span><span class="nx">spotMarketIndex</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">spotPosition</span> <span class="o">=</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">getSpotPosition</span><span class="p">(</span><span class="nx">spotMarketIndex</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">tokenAmount</span> <span class="o">=</span> <span class="nx">getTokenAmount</span><span class="p">(</span><span class="nx">spotPosition</span><span class="p">.</span><span class="nx">scaledBalance</span><span class="p">,</span> <span class="nx">spotMarket</span><span class="p">,</span> <span class="nx">spotPosition</span><span class="p">.</span><span class="nx">balanceType</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">convertToNumber</span><span class="p">(</span><span class="nx">tokenAmount</span><span class="p">,</span> <span class="nx">spotConfig</span><span class="p">.</span><span class="nx">precision</span><span class="p">));</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="n">spot_market_index</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># USDC
</span><span class="n">spot_market</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_spot_market_account</span><span class="p">(</span><span class="n">spot_market_index</span><span class="p">)</span>
<span class="n">spot_position</span> <span class="o">=</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">get_spot_position</span><span class="p">(</span><span class="n">spot_market_index</span><span class="p">)</span>
<span class="n">token_amount</span> <span class="o">=</span> <span class="n">get_token_amount</span><span class="p">(</span><span class="n">spot_psoition</span><span class="p">.</span><span class="n">scaled_balance</span><span class="p">,</span> <span class="n">spot_market</span><span class="p">,</span> <span class="n">spot_position</span><span class="p">.</span><span class="n">balance_type</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">convert_to_number</span><span class="p">(</span><span class="n">token_amount</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">spot_market</span><span class="p">.</span><span class="n">decimals</span><span class="p">)))</span>
</code></pre></div>
<p>This prints the current spot position in spot market index 0 (USDC). This value is the same as the value shown on the UI,
it includes any accumulated interest.</p>
<h2 id='common-precision-values'>Common precision values</h2>
<table><thead>
<tr>
<th>Value</th>
<th>Precision</th>
<th>Constant</th>
</tr>
</thead><tbody>
<tr>
<td>perp base asset amount</td>
<td>1e9</td>
<td><code>BASE_PRECISION</code></td>
</tr>
<tr>
<td>perp quote asset amount</td>
<td>1e6</td>
<td><code>QUOTE_PRECISION</code></td>
</tr>
<tr>
<td>price</td>
<td>1e6</td>
<td><code>PRICE_PRECISION</code></td>
</tr>
<tr>
<td>funding rate</td>
<td>1e9</td>
<td><code>FUNDING_RATE_PRECISION</code></td>
</tr>
<tr>
<td>spot token amount</td>
<td>derived from token mint&#39;s decimals (USDC is 1e6, SOL is 1e9)</td>
<td><code>SpotMarketConfig.precision</code></td>
</tr>
<tr>
<td>spot token balance</td>
<td>1e9</td>
<td><code>SPOT_MARKET_BALANCE_PRECISION</code></td>
</tr>
<tr>
<td>margin ratio</td>
<td>1e4</td>
<td><code>MARGIN_PRECISION</code></td>
</tr>
<tr>
<td>asset/liability weight</td>
<td>1e4</td>
<td><code>SPOT_WEIGHT_PRECISION</code></td>
</tr>
</tbody></table>
<h1 id='examples-bots'>Examples Bots</h1>
<aside class="notice">
This examples should be used as code reference only. Be cautious running any unreviewed code, especially off devnet.
</aside>
<h2 id='typescript'>Typescript</h2>
<p><a href="https://github.com/drift-labs/keeper-bots-v2">Keeper-bots-v2</a></p>
<h3 id='perp-markets'>Perp Markets</h3>
<ul>
<li>perp filler</li>
<li>floating maker</li>
<li>jit maker</li>
<li>funding rate update</li>
<li>pnl settler</li>
</ul>
<h3 id='spot-markets'>Spot Markets</h3>
<ul>
<li>spot filler</li>
<li>insurance fund revenue settler</li>
</ul>
<h2 id='python'>Python</h2>
<p><a href="https://github.com/drift-labs/driftpy/tree/master/examples">driftpy examples/</a></p>
<h1 id='orderbook-blockchain'>Orderbook (Blockchain)</h1>
<p>The drift orderbook is a collection of all open orders on the Drift protocol. There is no single source of truth for the orderbook. The most up to date view of the orderbook is one where you track user orders and maintain the orderbook structure yourself. This section shows how to do that with the various SDKs.</p>
<h2 id='dlob-source'>Dlob Source</h2>
<p>This is the main source of orders for maintaing the orderbook.</p>
<h2 id='dlob-source-usermap'>Dlob Source - <code>UserMap</code></h2>
<p><code>UserMap</code> stores a complete map of all user accounts (idle users are commonly filtered ou).</p>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Connection</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@solana/web3.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">DriftClient</span><span class="p">,</span> <span class="nx">UserMap</span><span class="p">,</span> <span class="nx">Wallet</span><span class="p">,</span> <span class="nx">loadKeypair</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@drift-labs/sdk</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://api.mainnet-beta.solana.com</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">keyPairFile</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">}</span><span class="s2">/.config/solana/my-keypair.json`</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wallet</span><span class="p">(</span><span class="nx">loadKeypair</span><span class="p">(</span><span class="nx">keyPairFile</span><span class="p">))</span>

<span class="kd">const</span> <span class="nx">driftClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DriftClient</span><span class="p">({</span>
  <span class="nx">connection</span><span class="p">,</span>
  <span class="nx">wallet</span><span class="p">,</span>
  <span class="na">env</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mainnet-beta</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>

<span class="c1">// polling keep users updated with periodic calls to getProgramAccounts</span>
<span class="c1">// websocket keep users updated via programSubscribe</span>
<span class="kd">const</span> <span class="nx">subscriptionConfig</span><span class="p">:</span>
  <span class="o">|</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">polling</span><span class="dl">'</span><span class="p">;</span>
    <span class="nl">frequency</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">commitment</span><span class="p">?:</span> <span class="nx">Commitment</span><span class="p">;</span>
  <span class="p">}</span> <span class="o">|</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">websocket</span><span class="dl">'</span><span class="p">;</span>
    <span class="nl">resubTimeoutMs</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">commitment</span><span class="p">?:</span> <span class="nx">Commitment</span><span class="p">;</span>
  <span class="p">}</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">websocket</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">resubTimeoutMs</span><span class="p">:</span> <span class="mi">30</span><span class="nx">_000</span><span class="p">,</span>
    <span class="na">commitment</span><span class="p">:</span> <span class="nx">stateCommitment</span><span class="p">,</span>
  <span class="p">};</span>

<span class="kd">const</span> <span class="nx">userMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserMap</span><span class="p">({</span>
  <span class="nx">driftClient</span><span class="p">,</span>
  <span class="nx">connection</span><span class="p">,</span>
  <span class="nx">subscriptionConfig</span><span class="p">,</span>
  <span class="na">skipInitialLoad</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// skips initial load of user accounts</span>
  <span class="na">includeIdle</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// filters out idle users</span>
<span class="p">});</span>

<span class="k">await</span> <span class="nx">userMap</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">solana.rpc.async_api</span> <span class="kn">import</span> <span class="n">AsyncClient</span>
<span class="kn">from</span> <span class="nn">solders.keypair</span> <span class="kn">import</span> <span class="n">Keypair</span>
<span class="kn">from</span> <span class="nn">anchorpy</span> <span class="kn">import</span> <span class="n">Wallet</span>
<span class="kn">from</span> <span class="nn">driftpy.drift_client</span> <span class="kn">import</span> <span class="n">DriftClient</span>
<span class="kn">from</span> <span class="nn">driftpy.keypair</span> <span class="kn">import</span> <span class="n">load_keypair</span>
<span class="kn">from</span> <span class="nn">driftpy.user_map.user_map</span> <span class="kn">import</span> <span class="n">UserMap</span>
<span class="kn">from</span> <span class="nn">driftpy.user_map.user_map_config</span> <span class="kn">import</span> <span class="n">UserMapConfig</span><span class="p">,</span> <span class="n">WebsocketConfig</span>

<span class="n">connection</span> <span class="o">=</span> <span class="n">AsyncClient</span><span class="p">(</span><span class="s">"https://api.mainnet-beta.solana.com"</span><span class="p">)</span>  <span class="c1"># switch for your own rpc
</span>
<span class="n">keypair_file</span> <span class="o">=</span> <span class="s">""</span>  <span class="c1"># path to keypair file
</span>
<span class="n">wallet</span> <span class="o">=</span> <span class="n">Wallet</span><span class="p">(</span><span class="n">load_keypair</span><span class="p">(</span><span class="n">keypair_file</span><span class="p">))</span>

<span class="n">drift_client</span> <span class="o">=</span> <span class="n">DriftClient</span><span class="p">(</span>
  <span class="n">connection</span><span class="p">,</span>
  <span class="n">wallet</span><span class="p">,</span>
  <span class="s">"mainnet"</span>
<span class="p">)</span>

<span class="k">await</span> <span class="n">drift_client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>

<span class="n">user_map_config</span> <span class="o">=</span> <span class="n">UserMapConfig</span><span class="p">(</span><span class="n">drift_client</span><span class="p">,</span> <span class="n">WebsocketConfig</span><span class="p">())</span>
<span class="n">user_map</span> <span class="o">=</span> <span class="n">UserMap</span><span class="p">(</span><span class="n">user_map_config</span><span class="p">)</span>

<span class="k">await</span> <span class="n">user_map</span><span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>
</code></pre></div><h2 id='dlob-source-ordersubscriber'>Dlob Source - <code>OrderSubscriber</code></h2>
<p><code>OrderSubscriber</code> is a more efficient version of <code>UserMap</code>, only tracking user accounts that have orders.</p>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">import</span> <span class="p">{</span><span class="nx">Connection</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@solana/web3.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">DriftClient</span><span class="p">,</span> <span class="nx">OrderSubscriber</span><span class="p">,</span> <span class="nx">Wallet</span><span class="p">,</span> <span class="nx">loadKeypair</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@drift-labs/sdk</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Connection</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://api.mainnet-beta.solana.com</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">keyPairFile</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">}</span><span class="s2">/.config/solana/my-keypair.json`</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wallet</span><span class="p">(</span><span class="nx">loadKeypair</span><span class="p">(</span><span class="nx">keyPairFile</span><span class="p">))</span>

<span class="kd">const</span> <span class="nx">driftClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DriftClient</span><span class="p">({</span>
  <span class="nx">connection</span><span class="p">,</span>
  <span class="nx">wallet</span><span class="p">,</span>
  <span class="na">env</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mainnet-beta</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>
<span class="k">await</span> <span class="nx">driftClient</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">subscriptionConfig</span><span class="p">:</span>
  <span class="o">|</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">polling</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">frequency</span><span class="p">:</span> <span class="nx">ORDERBOOK_UPDATE_INTERVAL</span><span class="p">,</span>
    <span class="na">commitment</span><span class="p">:</span> <span class="nx">stateCommitment</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="o">|</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">websocket</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">commitment</span><span class="p">:</span> <span class="nx">stateCommitment</span><span class="p">,</span>
    <span class="na">resyncIntervalMs</span><span class="p">:</span> <span class="nx">WS_FALLBACK_FETCH_INTERVAL</span><span class="p">,</span>
  <span class="p">}</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">websocket</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">commitment</span><span class="p">:</span> <span class="nx">stateCommitment</span><span class="p">,</span>
    <span class="na">resyncIntervalMs</span><span class="p">:</span> <span class="nx">WS_FALLBACK_FETCH_INTERVAL</span><span class="p">,</span> <span class="c1">// periodically resyncs the orders in case of missed websocket messages</span>
  <span class="p">};</span>

<span class="kd">const</span> <span class="nx">orderSubscriber</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrderSubscriber</span><span class="p">({</span>
  <span class="nx">driftClient</span><span class="p">,</span>
  <span class="nx">subscriptionConfig</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">await</span> <span class="nx">orderSubscriber</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>
</code></pre></div><h2 id='orderbook-subscription'>Orderbook Subscription</h2>
<p>With a <code>DlobSource</code> you can then subscribe to the orderbook.</p>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="k">import</span> <span class="p">{</span><span class="nx">DLOBSubscriber</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@drift-labs/sdk</span><span class="dl">"</span><span class="p">;</span>

 <span class="kd">const</span> <span class="nx">dlobSubscriber</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DLOBSubscriber</span><span class="p">({</span>
    <span class="nx">driftClient</span><span class="p">,</span>
    <span class="na">dlobSource</span><span class="p">:</span> <span class="nx">orderSubscriber</span><span class="p">,</span> <span class="c1">// or UserMap</span>
    <span class="na">slotSource</span><span class="p">:</span> <span class="nx">orderSubscriber</span><span class="p">,</span> <span class="c1">// or UserMap</span>
    <span class="na">updateFrequency</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
 <span class="p">});</span>

<span class="k">await</span> <span class="nx">dlobSubscriber</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">();</span>
</code></pre></div><h3 id='typescript'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>driftClient</td>
<td>DriftClient object</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>dlobSource</td>
<td>Where to build the orderbook from. Can subscribe to user accounts on-chain using UserMap or request DLOB from api using DLOBApiClient</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>slotSource</td>
<td>Where to get slot from</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>updateFrequency</td>
<td>How often to rebuild the orderbook from the dlobSource in milliseconds</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">driftpy.dlob.dlob_subscriber</span> <span class="kn">import</span> <span class="n">DLOBSubscriber</span>
<span class="kn">from</span> <span class="nn">driftpy.dlob.client_types</span> <span class="kn">import</span> <span class="n">DLOBClientConfig</span>
<span class="kn">from</span> <span class="nn">driftpy.slot.slot_subscriber</span> <span class="kn">import</span> <span class="n">SlotSubscriber</span>

<span class="n">slot_subscriber</span> <span class="o">=</span> <span class="n">SlotSubscriber</span><span class="p">(</span><span class="n">drift_client</span><span class="p">)</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">DLOBClientConfig</span><span class="p">(</span><span class="n">drift_client</span><span class="p">,</span> <span class="n">user_map</span><span class="p">,</span> <span class="n">slot_subscriber</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">dlob_subscriber</span> <span class="o">=</span> <span class="n">DLOBSubscriber</span><span class="p">(</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">)</span>

<span class="k">await</span> <span class="n">dlob_subscriber</span><span class="p">.</span><span class="n">subscribe</span><span class="p">()</span>
</code></pre></div><h3 id='python'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>drift_client</td>
<td>DriftClient object</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>dlob_source</td>
<td>Where to build the orderbook from. Can subscribe to user accounts on-chain using UserMap.</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>slot_source</td>
<td>Where to get slot from</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>update_frequency</td>
<td>How often to rebuild the orderbook from the dlob_source in milliseconds</td>
<td>No</td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-l2-orderbook'>Get L2 Orderbook</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">l2</span> <span class="o">=</span> <span class="nx">dlobSubscriber</span><span class="p">.</span><span class="nx">getL2</span><span class="p">({</span>
  <span class="na">marketName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SOL-PERP</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">depth</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div><h3 id='typescript-2'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketName</td>
<td>The market name of the orderbook to get. If not set, marketIndex and marketType must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The market index of the orderbook to get. If not set, marketName must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>marketType</td>
<td>The market type of the orderbook to get. If not set, marketName must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>depth</td>
<td>The depth of the orderbook to get</td>
<td>Yes</td>
<td>10</td>
</tr>
<tr>
<td>includeVamm</td>
<td>Whether to include vAMM</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>fallbackL2Generators</td>
<td>L2OrderbookGenerators for fallback liquidity e.g. vAmm, openbook, phoenix. Unnecessary if includeVamm is true</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="n">l2</span> <span class="o">=</span> <span class="n">dlob_subscriber</span><span class="p">.</span><span class="n">get_l2_orderbook_sync</span><span class="p">(</span><span class="s">"SOL-PERP"</span><span class="p">)</span>
</code></pre></div><h3 id='python-2'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_name</td>
<td>The market name of the orderbook to get. If not set, market_index and market_type must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>market_index</td>
<td>The market index of the orderbook to get. If not set, market_name must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>market_type</td>
<td>The market type of the orderbook to get. If not set, market_name must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>depth</td>
<td>The depth of the orderbook to get</td>
<td>Yes</td>
<td>10</td>
</tr>
<tr>
<td>include_vamm</td>
<td>Whether to include vAMM</td>
<td>Yes</td>
<td>false</td>
</tr>
<tr>
<td>num_vamm_orders</td>
<td>Number of orders to include from the vAMM.  If not provided, depth is used.</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>fallback_l2_generators</td>
<td>L2OrderbookGenerators for fallback liquidity e.g. vAmm, openbook, phoenix. Unnecessary if includeVamm is true</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>

<p>The L2 orderbook is an aggregate of drift dlob orders and, optionally, fallback liquidity.</p>
<h2 id='get-l3-orderbook'>Get L3 Orderbook</h2><div class="highlight"><pre class="highlight typescript tab-typescript"><code><span class="kd">const</span> <span class="nx">l3</span> <span class="o">=</span> <span class="nx">dlobSubscriber</span><span class="p">.</span><span class="nx">getL3</span><span class="p">({</span>
  <span class="na">marketName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SOL-PERP</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div><h3 id='typescript-3'>TypeScript</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketName</td>
<td>The market name of the orderbook to get. If not set, marketIndex and marketType must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The market index of the orderbook to get. If not set, marketName must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>marketType</td>
<td>The market type of the orderbook to get. If not set, marketName must be set</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<div class="highlight"><pre class="highlight python tab-python"><code><span class="n">l3</span> <span class="o">=</span> <span class="n">dlob_subscriber</span><span class="p">.</span><span class="n">get_l3_orderbook_sync</span><span class="p">(</span><span class="s">"SOL-PERP"</span><span class="p">)</span>
</code></pre></div><h3 id='python-3'>Python</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>market_name</td>
<td>The market name of the orderbook to get. If not set, market_index and market_type must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>market_index</td>
<td>The market index of the orderbook to get. If not set, market_name must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>market_type</td>
<td>The market type of the orderbook to get. If not set, market_name must be set</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>

<p>The L3 orderbook contains every maker order on drift dlob, including the address for the user that placed the order.</p>
<h1 id='orderbook-trades-dlob-server'>Orderbook/Trades (DLOB Server)</h1>
<p>Drift runs a <a href="https://github.com/drift-labs/dlob-server"><code>dlob-server</code></a> to reduce the RPC load on UI users and traders. You can access this server (or run your own!) instead of <a href="#orderbook-blockchain">maintaing an order book from the blockchain</a>.</p>

<p>mainnet-beta: <a href="https://dlob.drift.trade/">https://dlob.drift.trade/</a>
devnet: <a href="https://master.dlob.drift.trade/">https://master.dlob.drift.trade/</a></p>

<p>All endpoints follow the same query parameter scheme to specify a market:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>marketName</td>
<td>The market name of the orderbook to get. If not set, marketIndex and marketType must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>marketIndex</td>
<td>The market index of the orderbook to get. If not set, marketName must be set</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td>marketType</td>
<td>The market type of the orderbook to get. If not set, marketName must be set</td>
<td>Yes</td>
<td></td>
</tr>
</tbody></table>
<h2 id='get-l2'><code>GET /l2</code></h2><h2 id='get-l3'><code>GET /l3</code></h2>
<p>Returns an L2 (aggregate price levels) or L3 (individual orders) orderbook for the specificed market.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
<th>L2 only</th>
</tr>
</thead><tbody>
<tr>
<td>depth</td>
<td>Number of records to return per side</td>
<td>Yes</td>
<td>all orders</td>
<td>Yes</td>
</tr>
<tr>
<td>includeVamm</td>
<td><code>true</code> to include vAMM liquidity in the response</td>
<td>Yes</td>
<td><code>false</code></td>
<td>Yes</td>
</tr>
<tr>
<td>includeOracle</td>
<td><code>true</code> to include oracle data with the response</td>
<td>Yes</td>
<td><code>false</code></td>
<td>No</td>
</tr>
</tbody></table>

<p>Example: <a href="https://dlob.drift.trade/l2?marketName=JTO-PERP&amp;depth=10&amp;includeOracle=true&amp;includeVamm=true">https://dlob.drift.trade/l2?marketName=JTO-PERP&amp;depth=10&amp;includeOracle=true&amp;includeVamm=true</a></p>

<p>Example: <a href="https://dlob.drift.trade/l3?marketName=JTO-PERP&amp;includeOracle=true">https://dlob.drift.trade/l3?marketName=JTO-PERP&amp;includeOracle=true</a></p>
<h2 id='get-topmakers'><code>GET /topMakers</code></h2>
<p>Returns the top makers (currently returns an exhaustive list) for a given market (useful for <code>place_and_take</code> orders).</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>side</td>
<td>Side to return makers for (<code>bid</code> or <code>ask</code>)</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td>limit</td>
<td>Limit number of makers to return</td>
<td>Yes</td>
<td>all</td>
</tr>
<tr>
<td>includeUserStats</td>
<td><code>true</code> to include full UserStats</td>
<td>Yes</td>
<td><code>false</code></td>
</tr>
</tbody></table>

<p>Example: <a href="https://dlob.drift.trade/topMakers?marketName=JTO-PERP&amp;side=bid&amp;limit=5">https://dlob.drift.trade/topMakers?marketName=JTO-PERP&amp;side=bid&amp;limit=5</a></p>
<h2 id='websocket'>Websocket</h2>
<p>The mainnet-beta websocket endpoint is: <a href="wss://dlob.drift.trade/ws">wss://dlob.drift.trade/ws</a></p>

<p>Drift currently offers websocket streaming for two data streams: orderbooks and trades. The data streams are constructed from blockhain data. More data sources and user specific feeds will be added as this functionality is expanded.</p>

<p>mainnet-beta: <a href="wss://dlob.drift.trade/ws">wss://dlob.drift.trade/ws</a></p>

<p>devnet: <a href="wss://master.dlob.drift.trade/ws">wss://master.dlob.drift.trade/ws</a></p>
<h2 id='websocket-subscribing'>Websocket - Subscribing</h2>
<p>Clients must send subscribe messages over the websocket connection in order to start receiving messages.</p>
<h3 id='orderbook'>Orderbook</h3>
<p>Each market currently requires its own subscribe message. The two examples below show subscribe messages for a perp and spot market:</p>
<h4 id='perp-markets'>Perp markets</h4>
<p><code>
{
  &quot;type&quot;: &quot;subscribe&quot;,
  &quot;marketType&quot;: &quot;perp&quot;,
  &quot;channel&quot;: &quot;orderbook&quot;,
  &quot;market&quot;: &quot;SOL-PERP&quot;
}
</code></p>
<h4 id='response'>Response</h4>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>channel</td>
<td>Identifies the type of data being streamed. <code>orderbook_perp_0</code> indicates data for perpetual market 0 order book (SOL-PERP).</td>
</tr>
<tr>
<td>data</td>
<td>Contains the actual order book data in JSON format. This field is a JSON string that needs to be parsed.</td>
</tr>
<tr>
<td>bids</td>
<td>A list of bid orders in the order book, each representing an offer to buy.</td>
</tr>
<tr>
<td>asks</td>
<td>A list of ask orders in the order book, each representing an offer to sell.</td>
</tr>
<tr>
<td>price</td>
<td>The price at which the bid or ask is made.</td>
</tr>
<tr>
<td>size</td>
<td>The size of the bid or ask, indicating the quantity of the asset the buyer or seller wishes to transact.</td>
</tr>
<tr>
<td>sources</td>
<td>Indicates the origin or source of the bid or ask, such as <code>vamm</code> (Virtual Automated Market Maker) or <code>dlob</code> (Decentralized Limit Order Book).</td>
</tr>
<tr>
<td>marketName</td>
<td>Name of the market, e.g., <code>SOL-PERP</code>.</td>
</tr>
<tr>
<td>marketType</td>
<td>Type of the market, e.g., <code>perp</code> for perpetual.</td>
</tr>
<tr>
<td>marketIndex</td>
<td>Index of the market, used to identify specific markets within a market type.</td>
</tr>
<tr>
<td>slot</td>
<td>Solana slot.</td>
</tr>
<tr>
<td>oracle</td>
<td>The reported price from the oracle for this market.</td>
</tr>
<tr>
<td>oracleData</td>
<td>Contains detailed information from the oracle, including price, slot, confidence, etc.</td>
</tr>
<tr>
<td>oracleData.price</td>
<td>The price reported by the oracle.</td>
</tr>
<tr>
<td>oracleData.slot</td>
<td>The slot number associated with the oracle data.</td>
</tr>
<tr>
<td>oracleData.confidence</td>
<td>The confidence interval for the oracle price.</td>
</tr>
<tr>
<td>oracleData.hasSufficientNumberOfDataPoints</td>
<td>Indicates whether the oracle has sufficient data points for reliability.</td>
</tr>
<tr>
<td>oracleData.twap</td>
<td>The time-weighted average price as reported by the oracle.</td>
</tr>
<tr>
<td>oracleData.twapConfidence</td>
<td>The confidence interval for the time-weighted average price.</td>
</tr>
<tr>
<td>marketSlot</td>
<td>Slot number associated with the market data.</td>
</tr>
</tbody></table>
<h4 id='spot-markets'>Spot markets</h4>
<p><code>
{
  &quot;type&quot;: &quot;subscribe&quot;,
  &quot;marketType&quot;: &quot;spot&quot;,
  &quot;channel&quot;: &quot;orderbook&quot;,
  &quot;market&quot;: &quot;SOL&quot;
}
</code></p>
<h4 id='response-2'>Response</h4>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>channel</td>
<td>Identifies the type of data being streamed. i.e <code>orderbook_spot_1</code> indicates data for the spot market order book (SOL/USDC).</td>
</tr>
<tr>
<td>data</td>
<td>Contains the actual order book data in JSON format. This field is a JSON string that needs to be parsed.</td>
</tr>
<tr>
<td>bids</td>
<td>A list of bid orders in the order book, each representing an offer to buy.</td>
</tr>
<tr>
<td>asks</td>
<td>A list of ask orders in the order book, each representing an offer to sell.</td>
</tr>
<tr>
<td>price</td>
<td>The price at which the bid or ask is made.</td>
</tr>
<tr>
<td>size</td>
<td>The size of the bid or ask, indicating the quantity of the asset the buyer or seller wishes to transact.</td>
</tr>
<tr>
<td>sources</td>
<td>Indicates the origin or source of the bid or ask, such as <code>phoenix</code> or <code>serum</code>, representing different liquidity providers.</td>
</tr>
<tr>
<td>slot</td>
<td>Solana slot.</td>
</tr>
<tr>
<td>marketName</td>
<td>Name of the market, e.g., <code>SOL</code>.</td>
</tr>
<tr>
<td>marketType</td>
<td>Type of the market, e.g., <code>spot</code>.</td>
</tr>
<tr>
<td>marketIndex</td>
<td>Index of the market, used to identify specific markets within a market type.</td>
</tr>
<tr>
<td>oracle</td>
<td>The reported price from the oracle for this market.</td>
</tr>
<tr>
<td>oracleData</td>
<td>Contains detailed information from the oracle, including price, slot, confidence, etc.</td>
</tr>
<tr>
<td>oracleData.price</td>
<td>The price reported by the oracle.</td>
</tr>
<tr>
<td>oracleData.slot</td>
<td>The slot number associated with the oracle data.</td>
</tr>
<tr>
<td>oracleData.confidence</td>
<td>The confidence interval for the oracle price.</td>
</tr>
<tr>
<td>oracleData.hasSufficientNumberOfDataPoints</td>
<td>Indicates whether the oracle has sufficient data points for reliability.</td>
</tr>
<tr>
<td>oracleData.twap</td>
<td>The time-weighted average price as reported by the oracle.</td>
</tr>
<tr>
<td>oracleData.twapConfidence</td>
<td>The confidence interval for the time-weighted average price.</td>
</tr>
</tbody></table>
<div class="highlight"><pre class="highlight typescript tab-typescript"><code>
<span class="k">import</span> <span class="nx">WebSocket</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">ws</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="dl">'</span><span class="s1">wss://dlob.drift.trade/ws</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected to the server</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Subscribe to orderbook data</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subscribe</span><span class="dl">'</span><span class="p">,</span> <span class="na">marketType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">perp</span><span class="dl">'</span><span class="p">,</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">orderbook</span><span class="dl">'</span><span class="p">,</span> <span class="na">market</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SOL-PERP</span><span class="dl">'</span> <span class="p">}));</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subscribe</span><span class="dl">'</span><span class="p">,</span> <span class="na">marketType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">spot</span><span class="dl">'</span><span class="p">,</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">orderbook</span><span class="dl">'</span><span class="p">,</span> <span class="na">market</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SOL</span><span class="dl">'</span> <span class="p">}));</span>


  <span class="c1">// Subscribe to trades data</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subscribe</span><span class="dl">'</span><span class="p">,</span> <span class="na">marketType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">perp</span><span class="dl">'</span><span class="p">,</span> <span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">trades</span><span class="dl">'</span><span class="p">,</span> <span class="na">market</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SOL-PERP</span><span class="dl">'</span> <span class="p">}));</span>
<span class="p">});</span>

<span class="nx">ws</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">WebSocket</span><span class="p">.</span><span class="nx">Data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Received data from channel: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
    <span class="c1">// book and trades data is in message.data</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Invalid message:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">websocket</span>
<span class="kn">import</span> <span class="nn">ssl</span>

<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Received data from channel: </span><span class="si">{</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s">'channel'</span><span class="p">])</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="c1"># book and trades data is in message['data']
</span>    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Invalid message: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">close_status_code</span><span class="p">,</span> <span class="n">close_msg</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"### Closed ###"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_open</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Connected to the server"</span><span class="p">)</span>

    <span class="c1"># Subscribe to orderbook data
</span>    <span class="n">ws</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'subscribe'</span><span class="p">,</span> <span class="s">'marketType'</span><span class="p">:</span> <span class="s">'perp'</span><span class="p">,</span> <span class="s">'channel'</span><span class="p">:</span> <span class="s">'orderbook'</span><span class="p">,</span> <span class="s">'market'</span><span class="p">:</span> <span class="s">'SOL-PERP'</span><span class="p">}))</span>
    <span class="n">ws</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'subscribe'</span><span class="p">,</span> <span class="s">'marketType'</span><span class="p">:</span> <span class="s">'spot'</span><span class="p">,</span> <span class="s">'channel'</span><span class="p">:</span> <span class="s">'orderbook'</span><span class="p">,</span> <span class="s">'market'</span><span class="p">:</span> <span class="s">'SOL'</span><span class="p">}))</span>

    <span class="c1"># Subscribe to trades data
</span>    <span class="n">ws</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">'type'</span><span class="p">:</span> <span class="s">'subscribe'</span><span class="p">,</span> <span class="s">'marketType'</span><span class="p">:</span> <span class="s">'perp'</span><span class="p">,</span> <span class="s">'channel'</span><span class="p">:</span> <span class="s">'trades'</span><span class="p">,</span> <span class="s">'market'</span><span class="p">:</span> <span class="s">'SOL-PERP'</span><span class="p">}))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">websocket</span><span class="p">.</span><span class="n">enableTrace</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="p">.</span><span class="n">WebSocketApp</span><span class="p">(</span><span class="s">"wss://dlob.drift.trade/ws"</span><span class="p">,</span>
                                <span class="n">on_open</span><span class="o">=</span><span class="n">on_open</span><span class="p">,</span>
                                <span class="n">on_message</span><span class="o">=</span><span class="n">on_message</span><span class="p">,</span>
                                <span class="n">on_error</span><span class="o">=</span><span class="n">on_error</span><span class="p">,</span>
                                <span class="n">on_close</span><span class="o">=</span><span class="n">on_close</span><span class="p">)</span>

    <span class="n">ws</span><span class="p">.</span><span class="n">run_forever</span><span class="p">(</span><span class="n">sslopt</span><span class="o">=</span><span class="p">{</span><span class="s">"cert_reqs"</span><span class="p">:</span> <span class="n">ssl</span><span class="p">.</span><span class="n">CERT_NONE</span><span class="p">})</span>
</code></pre></div><h4 id='update-frequency'>Update frequency</h4>
<p>Currently, orderbook websockets send messages every 1000ms. Connections that contain frequent updates are coming soon.</p>
<h3 id='trades'>Trades</h3>
<p>Trades feed subscribe messages take a similar form to orderbook data, just change the channel.</p>
<h4 id='perp-markets-2'>Perp markets</h4>
<p><code>
{
  &quot;type&quot;: &quot;subscribe&quot;,
  &quot;marketType&quot;: &quot;perp&quot;,
  &quot;channel&quot;: &quot;trades&quot;,
  &quot;market&quot;: &quot;SOL-PERP&quot;
}
</code></p>
<h4 id='response-3'>Response</h4>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>channel</td>
<td>Identifies the type of data being streamed. <code>trades_perp_0</code> indicates data for trades in perp market 0. (SOL-PERP)</td>
</tr>
<tr>
<td>ts</td>
<td>Timestamp of the trade.</td>
</tr>
<tr>
<td>marketIndex</td>
<td>Index of the market where the trade occurred.</td>
</tr>
<tr>
<td>marketType</td>
<td>Type of the market, here it&#39;s <code>perp</code> for perpetual.</td>
</tr>
<tr>
<td>filler</td>
<td>The address or identifier of the filler (taker) in the trade.</td>
</tr>
<tr>
<td>takerFee</td>
<td>Fee paid by the taker in the trade.</td>
</tr>
<tr>
<td>makerFee</td>
<td>Fee paid or received by the maker in the trade.</td>
</tr>
<tr>
<td>quoteAssetAmountSurplus</td>
<td>Surplus amount in quote asset.</td>
</tr>
<tr>
<td>baseAssetAmountFilled</td>
<td>The amount of the base asset that was filled in this trade.</td>
</tr>
<tr>
<td>quoteAssetAmountFilled</td>
<td>The amount of the quote asset that was filled in this trade.</td>
</tr>
<tr>
<td>takerOrderId</td>
<td>Order ID of the taker&#39;s order, if available.</td>
</tr>
<tr>
<td>takerOrderBaseAssetAmount</td>
<td>Base asset amount specified in the taker&#39;s order.</td>
</tr>
<tr>
<td>takerOrderCumulativeBaseAssetAmountFilled</td>
<td>Cumulative base asset amount filled in the taker&#39;s order.</td>
</tr>
<tr>
<td>takerOrderCumulativeQuoteAssetAmountFilled</td>
<td>Cumulative quote asset amount filled in the taker&#39;s order.</td>
</tr>
<tr>
<td>maker</td>
<td>The address or identifier of the maker in the trade.</td>
</tr>
<tr>
<td>makerOrderId</td>
<td>Order ID of the maker&#39;s order.</td>
</tr>
<tr>
<td>makerOrderDirection</td>
<td>Direction of the maker&#39;s order (e.g., &#39;short&#39; or &#39;long&#39;).</td>
</tr>
<tr>
<td>makerOrderBaseAssetAmount</td>
<td>Base asset amount specified in the maker&#39;s order.</td>
</tr>
<tr>
<td>makerOrderCumulativeBaseAssetAmountFilled</td>
<td>Cumulative base asset amount filled in the maker&#39;s order.</td>
</tr>
<tr>
<td>makerOrderCumulativeQuoteAssetAmountFilled</td>
<td>Cumulative quote asset amount filled in the maker&#39;s order.</td>
</tr>
<tr>
<td>oraclePrice</td>
<td>The oracle price at the time of the trade.</td>
</tr>
<tr>
<td>txSig</td>
<td>Transaction signature.</td>
</tr>
<tr>
<td>slot</td>
<td>Slot number in which the trade occurred.</td>
</tr>
<tr>
<td>action</td>
<td>fill.</td>
</tr>
<tr>
<td>actionExplanation</td>
<td>Explanation of the action (e.g., &#39;orderFilledWithAmm&#39; indicating order filled with Automated Market Maker).</td>
</tr>
<tr>
<td>referrerReward</td>
<td>Reward amount for the referrer, if applicable.</td>
</tr>
</tbody></table>
<h4 id='spot-markets-2'>Spot markets</h4>
<p><code>
{
  &quot;type&quot;: &quot;subscribe&quot;,
  &quot;marketType&quot;: &quot;spot&quot;,
  &quot;channel&quot;: &quot;trades&quot;,
  &quot;market&quot;: &quot;SOL&quot;
}
</code></p>
<h4 id='response-4'>Response</h4>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>channel</td>
<td>Identifies the type of data being streamed. <code>trades_spot_1</code> indicates data for trades in spot market 1 (SOL/USDC).</td>
</tr>
<tr>
<td>ts</td>
<td>Timestamp of the trade.</td>
</tr>
<tr>
<td>marketIndex</td>
<td>Index of the market where the trade occurred.</td>
</tr>
<tr>
<td>marketType</td>
<td>Type of the market, here it&#39;s <code>spot</code>.</td>
</tr>
<tr>
<td>filler</td>
<td>The address or identifier of the filler (taker) in the trade.</td>
</tr>
<tr>
<td>takerFee</td>
<td>Fee paid by the taker in the trade.</td>
</tr>
<tr>
<td>makerFee</td>
<td>Fee paid or received by the maker in the trade.</td>
</tr>
<tr>
<td>quoteAssetAmountSurplus</td>
<td>Surplus amount in quote asset.</td>
</tr>
<tr>
<td>baseAssetAmountFilled</td>
<td>The amount of the base asset that was filled in this trade.</td>
</tr>
<tr>
<td>quoteAssetAmountFilled</td>
<td>The amount of the quote asset that was filled in this trade.</td>
</tr>
<tr>
<td>taker</td>
<td>The address or identifier of the taker in the trade.</td>
</tr>
<tr>
<td>takerOrderId</td>
<td>Order ID of the taker&#39;s order, if available.</td>
</tr>
<tr>
<td>takerOrderDirection</td>
<td>Direction of the taker&#39;s order (e.g., &#39;long&#39;).</td>
</tr>
<tr>
<td>takerOrderBaseAssetAmount</td>
<td>Base asset amount specified in the taker&#39;s order.</td>
</tr>
<tr>
<td>takerOrderCumulativeBaseAssetAmountFilled</td>
<td>Cumulative base asset amount filled in the taker&#39;s order.</td>
</tr>
<tr>
<td>takerOrderCumulativeQuoteAssetAmountFilled</td>
<td>Cumulative quote asset amount filled in the taker&#39;s order.</td>
</tr>
<tr>
<td>maker</td>
<td>The address or identifier of the maker in the trade.</td>
</tr>
<tr>
<td>makerOrderId</td>
<td>Order ID of the maker&#39;s order.</td>
</tr>
<tr>
<td>makerOrderDirection</td>
<td>Direction of the maker&#39;s order (e.g., &#39;short&#39;).</td>
</tr>
<tr>
<td>makerOrderBaseAssetAmount</td>
<td>Base asset amount specified in the maker&#39;s order.</td>
</tr>
<tr>
<td>makerOrderCumulativeBaseAssetAmountFilled</td>
<td>Cumulative base asset amount filled in the maker&#39;s order.</td>
</tr>
<tr>
<td>makerOrderCumulativeQuoteAssetAmountFilled</td>
<td>Cumulative quote asset amount filled in the maker&#39;s order.</td>
</tr>
<tr>
<td>oraclePrice</td>
<td>The oracle price at the time of the trade.</td>
</tr>
<tr>
<td>txSig</td>
<td>Transaction signature.</td>
</tr>
<tr>
<td>slot</td>
<td>Slot number in which the trade occurred.</td>
</tr>
<tr>
<td>action</td>
<td>Type of action that occurred (e.g., &#39;fill&#39;).</td>
</tr>
<tr>
<td>actionExplanation</td>
<td>Explanation of the action (e.g., &#39;orderFilledWithMatch&#39; indicating order filled with a matching order).</td>
</tr>
<tr>
<td>referrerReward</td>
<td>Reward amount for the referrer, if applicable.</td>
</tr>
</tbody></table>
<h2 id='websocket-unsubscribing'>Websocket - Unsubscribing</h2>
<p>To unsubscribe to a channel, send a subscribe-like message, with the message type set to <code>unsubscribe</code>. Unsubscribe requests to channels not previously subscribed to will have no impact.
<code>
{
  &quot;type&quot;: &quot;unsubscribe&quot;,
  &quot;marketType&quot;: &quot;perp&quot;,
  &quot;channel&quot;: &quot;orderbook&quot;,
  &quot;market&quot;: &quot;SOL-PERP&quot;
}
</code></p>
<h2 id='websocket-liveness-measure'>Websocket - Liveness measure</h2>
<p>To alleviate backpressure on websocket servers, drift websockets stop sending messages to clients that have more than 50 messages unproccessed in their buffer, until the buffer is cleared and the messages are processed. We recommend listening for heartbeat messages from the server to determine if your client is still receiving messages.</p>

<p>Heartbeat messages are sent every 5 seconds and take the following form:
<code>
  {&quot;channel&quot;: &quot;heartbeat&quot;}
</code></p>
<h3 id='ping-pong'>Ping/pong</h3>
<p>No ping messages are sent from the websocket server. Unsolicited ping messages are allowed and will receive pongs back.</p>
<h1 id='data-api'>Data API</h1>
<p>The Drift Data API provides public access to various APIs that Drift uses, offering information about markets, contracts, and tokenomics. This API allows developers and users to retrieve data related to the Drift protocol.</p>

<p>mainnet-beta: <a href="https://data.api.drift.trade/">https://data.api.drift.trade/</a>
devnet: <a href="https://master-data.api.drift.trade/">https://master-data.drift.trade/</a></p>
<h2 id='rate-limiting'>Rate Limiting</h2>
<p>To ensure fair usage and maintain system stability, the Drift Data API implements rate limiting. Users are restricted to a certain number of requests per minute. The exact limit may vary depending on the endpoint and overall system load. If you exceed the rate limit, you&#39;ll receive a 429 (Too Many Requests) response. It&#39;s recommended to implement exponential backoff in your applications to handle rate limiting gracefully.</p>
<h2 id='caching'>Caching</h2>
<p>The Drift Data API utilizes caching mechanisms to improve performance and reduce server load. Responses may be cached for a short period, typically ranging from a few seconds to a few minutes, depending on the endpoint and the nature of the data. While this ensures quick response times, it also means that there might be a slight delay in reflecting the most recent updates. Time-sensitive operations should account for this potential delay.</p>
<h2 id='get-contracts'><code>GET /contracts</code></h2>
<p>Returns the contract information for each market </p>

<p>Example: <a href="https://data.api.drift.trade/contracts">https://data.api.drift.trade/contracts</a></p>
<h2 id='get-drift'><code>GET /DRIFT/</code></h2>
<p>Returns the tokenomics information about the Drift token.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
<th>Optional</th>
<th>Values</th>
</tr>
</thead><tbody>
<tr>
<td>q</td>
<td>Metrics related to the drift tokenomics</td>
<td>NO</td>
<td>circulating-supply</td>
</tr>
</tbody></table>

<p>Example: <a href="https://data.api.drift.trade/DRIFT?q=circulating-supply">https://data.api.drift.trade/DRIFT?q=circulating-supply</a></p>
<h1 id='historical-data'>Historical Data</h1>
<p>Snapshots are collected by parsing on-chain transaction logs. For convience the below are parsed logs collected, stored as a CSV, and stored off-chain (~99% of records). Records are updated once per day.</p>

<p>Please share any transaction signatures or time ranges you believe might be missing in Drift Protocol Discord.</p>
<h2 id='url-prefix'>URL Prefix</h2>
<p>mainnet-beta:  <code>https://drift-historical-data-v2.s3.eu-west-1.amazonaws.com/program/dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH/</code></p>

<!-- devnet: `https://drift-historical-data.s3.us-east-1.amazonaws.com/program/dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH/` -->
<h2 id='url-suffix'>URL Suffix</h2><h3 id='schema'>Schema</h3>
<table><thead>
<tr>
<th>recordType</th>
<th>url suffix</th>
</tr>
</thead><tbody>
<tr>
<td>trades</td>
<td><code>user/${accountKey}/tradeRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>market-trades</td>
<td><code>market/${marketSymbol}/tradeRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>funding-rates</td>
<td><code>market/${marketSymbol}/fundingRateRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>funding-payments</td>
<td><code>user/${accountKey}/fundingPaymentRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>deposits</td>
<td><code>user/${accountKey}/depositRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>liquidations</td>
<td><code>user/${accountKey}/liquidationRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>settle-pnl</td>
<td><code>user/${accountKey}/settlePnlRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>lp</td>
<td><code>user/${accountKey}/lpRecord/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>insurance-fund</td>
<td><code>market/${marketSymbol}/insuranceFundRecords/${year}/${year}${month}${day}</code></td>
</tr>
<tr>
<td>insurance-fund-stake</td>
<td><code>authority/${authorityAccountKey}/insuranceFundStakeRecords/${year}/${year}${month}${day}</code></td>
</tr>
</tbody></table>
<h3 id='variables'>Variables</h3>
<table><thead>
<tr>
<th>variable</th>
<th>description</th>
<th>example</th>
</tr>
</thead><tbody>
<tr>
<td>accountKey</td>
<td>user sub account public key (not authority)</td>
<td></td>
</tr>
<tr>
<td>authority</td>
<td>authority public key</td>
<td></td>
</tr>
<tr>
<td>marketSymbol</td>
<td>market name</td>
<td>SOL-PERP</td>
</tr>
<tr>
<td>year</td>
<td></td>
<td>2023</td>
</tr>
<tr>
<td>month</td>
<td></td>
<td>4</td>
</tr>
<tr>
<td>day</td>
<td>utc time</td>
<td>25</td>
</tr>
<tr>
<td>candleResolution</td>
<td></td>
<td>1M</td>
</tr>
</tbody></table>
<h2 id='examples'>Examples</h2>
<p>Get historical trades on <code>SOL-PERP</code> for August 5, 2023:
<code>
https://drift-historical-data-v2.s3.eu-west-1.amazonaws.com/program/dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH/market/SOL-PERP/tradeRecords/2024/20240101
</code></p>
<h2 id='records-columns'>Records Columns</h2>
<p>Below are definitions of the columns in each record type.</p>
<h3 id='trades'>trades</h3>
<table><thead>
<tr>
<th>variable</th>
<th>description</th>
<th>example</th>
</tr>
</thead><tbody>
<tr>
<td>accountKey</td>
<td>user sub account public key (not authority)</td>
<td></td>
</tr>
</tbody></table>
<h3 id='funding-rates'>funding-rates</h3>
<p>note: &#39;rate&#39; is in quote per base, to allow for async settlement</p>

<table><thead>
<tr>
<th>variable</th>
<th>description</th>
<th>example</th>
</tr>
</thead><tbody>
<tr>
<td>fundingRate</td>
<td>the quote asset amount (precision=1e6) per base asset amount (precision=1e9)</td>
<td></td>
</tr>
</tbody></table>

<p>to convert to the rates seen on the ui, use the following formula: <code>(funding_rate / BASE_PRECISION) / (oracle_twap / QUOTE_PRECISION)  * 100</code></p>

<!-- ### market-trades

### funding-payments

### deposits

### liquidations

### candles

### settle-pnl-records -->
<div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">outcsv</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://drift-historical-data-v2.s3.eu-west-1.amazonaws.com/program/dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH/user/FrEFAwxdrzHxgc7S4cuFfsfLmcg8pfbxnkCQW83euyCS/tradeRecords/2023/20230201'</span><span class="p">)</span><span class="s">'
</span></code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl https://drift-historical-data-v2.s3.eu-west-1.amazonaws.com/program/dRiftyHA39MWEi3m9aunc5MzRF1JYuBsbn6VPcn33UH/user/FrEFAwxdrzHxgc7S4cuFfsfLmcg8pfbxnkCQW83euyCS/tradeRecords/2023/20230201 <span class="nt">--output</span> out.csv.gz
</code></pre></div><h1 id='errors'>Errors</h1>
<aside class="notice">
This is a table of program errors as described in the programs IDL.
</aside>

<p>Drift Protocol uses has following error codes:</p>

<table><thead>
<tr>
<th style="text-align: right">code</th>
<th style="text-align: left">name</th>
<th style="text-align: left">msg</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: right">6000</td>
<td style="text-align: left">InvalidSpotMarketAuthority</td>
<td style="text-align: left">Invalid Spot Market Authority</td>
</tr>
<tr>
<td style="text-align: right">6001</td>
<td style="text-align: left">InvalidInsuranceFundAuthority</td>
<td style="text-align: left">Clearing house not insurance fund authority</td>
</tr>
<tr>
<td style="text-align: right">6002</td>
<td style="text-align: left">InsufficientDeposit</td>
<td style="text-align: left">Insufficient deposit</td>
</tr>
<tr>
<td style="text-align: right">6003</td>
<td style="text-align: left">InsufficientCollateral</td>
<td style="text-align: left">Insufficient collateral</td>
</tr>
<tr>
<td style="text-align: right">6004</td>
<td style="text-align: left">SufficientCollateral</td>
<td style="text-align: left">Sufficient collateral</td>
</tr>
<tr>
<td style="text-align: right">6005</td>
<td style="text-align: left">MaxNumberOfPositions</td>
<td style="text-align: left">Max number of positions taken</td>
</tr>
<tr>
<td style="text-align: right">6006</td>
<td style="text-align: left">AdminControlsPricesDisabled</td>
<td style="text-align: left">Admin Controls Prices Disabled</td>
</tr>
<tr>
<td style="text-align: right">6007</td>
<td style="text-align: left">MarketDelisted</td>
<td style="text-align: left">Market Delisted</td>
</tr>
<tr>
<td style="text-align: right">6008</td>
<td style="text-align: left">MarketIndexAlreadyInitialized</td>
<td style="text-align: left">Market Index Already Initialized</td>
</tr>
<tr>
<td style="text-align: right">6009</td>
<td style="text-align: left">UserAccountAndUserPositionsAccountMismatch</td>
<td style="text-align: left">User Account And User Positions Account Mismatch</td>
</tr>
<tr>
<td style="text-align: right">6010</td>
<td style="text-align: left">UserHasNoPositionInMarket</td>
<td style="text-align: left">User Has No Position In Market</td>
</tr>
<tr>
<td style="text-align: right">6011</td>
<td style="text-align: left">InvalidInitialPeg</td>
<td style="text-align: left">Invalid Initial Peg</td>
</tr>
<tr>
<td style="text-align: right">6012</td>
<td style="text-align: left">InvalidRepegRedundant</td>
<td style="text-align: left">AMM repeg already configured with amt given</td>
</tr>
<tr>
<td style="text-align: right">6013</td>
<td style="text-align: left">InvalidRepegDirection</td>
<td style="text-align: left">AMM repeg incorrect repeg direction</td>
</tr>
<tr>
<td style="text-align: right">6014</td>
<td style="text-align: left">InvalidRepegProfitability</td>
<td style="text-align: left">AMM repeg out of bounds pnl</td>
</tr>
<tr>
<td style="text-align: right">6015</td>
<td style="text-align: left">SlippageOutsideLimit</td>
<td style="text-align: left">Slippage Outside Limit Price</td>
</tr>
<tr>
<td style="text-align: right">6016</td>
<td style="text-align: left">OrderSizeTooSmall</td>
<td style="text-align: left">Order Size Too Small</td>
</tr>
<tr>
<td style="text-align: right">6017</td>
<td style="text-align: left">InvalidUpdateK</td>
<td style="text-align: left">Price change too large when updating K</td>
</tr>
<tr>
<td style="text-align: right">6018</td>
<td style="text-align: left">AdminWithdrawTooLarge</td>
<td style="text-align: left">Admin tried to withdraw amount larger than fees collected</td>
</tr>
<tr>
<td style="text-align: right">6019</td>
<td style="text-align: left">MathError</td>
<td style="text-align: left">Math Error</td>
</tr>
<tr>
<td style="text-align: right">6020</td>
<td style="text-align: left">BnConversionError</td>
<td style="text-align: left">Conversion to u128/u64 failed with an overflow or underflow</td>
</tr>
<tr>
<td style="text-align: right">6021</td>
<td style="text-align: left">ClockUnavailable</td>
<td style="text-align: left">Clock unavailable</td>
</tr>
<tr>
<td style="text-align: right">6022</td>
<td style="text-align: left">UnableToLoadOracle</td>
<td style="text-align: left">Unable To Load Oracles</td>
</tr>
<tr>
<td style="text-align: right">6023</td>
<td style="text-align: left">PriceBandsBreached</td>
<td style="text-align: left">Price Bands Breached</td>
</tr>
<tr>
<td style="text-align: right">6024</td>
<td style="text-align: left">ExchangePaused</td>
<td style="text-align: left">Exchange is paused</td>
</tr>
<tr>
<td style="text-align: right">6025</td>
<td style="text-align: left">InvalidWhitelistToken</td>
<td style="text-align: left">Invalid whitelist token</td>
</tr>
<tr>
<td style="text-align: right">6026</td>
<td style="text-align: left">WhitelistTokenNotFound</td>
<td style="text-align: left">Whitelist token not found</td>
</tr>
<tr>
<td style="text-align: right">6027</td>
<td style="text-align: left">InvalidDiscountToken</td>
<td style="text-align: left">Invalid discount token</td>
</tr>
<tr>
<td style="text-align: right">6028</td>
<td style="text-align: left">DiscountTokenNotFound</td>
<td style="text-align: left">Discount token not found</td>
</tr>
<tr>
<td style="text-align: right">6029</td>
<td style="text-align: left">ReferrerNotFound</td>
<td style="text-align: left">Referrer not found</td>
</tr>
<tr>
<td style="text-align: right">6030</td>
<td style="text-align: left">ReferrerStatsNotFound</td>
<td style="text-align: left">ReferrerNotFound</td>
</tr>
<tr>
<td style="text-align: right">6031</td>
<td style="text-align: left">ReferrerMustBeWritable</td>
<td style="text-align: left">ReferrerMustBeWritable</td>
</tr>
<tr>
<td style="text-align: right">6032</td>
<td style="text-align: left">ReferrerStatsMustBeWritable</td>
<td style="text-align: left">ReferrerMustBeWritable</td>
</tr>
<tr>
<td style="text-align: right">6033</td>
<td style="text-align: left">ReferrerAndReferrerStatsAuthorityUnequal</td>
<td style="text-align: left">ReferrerAndReferrerStatsAuthorityUnequal</td>
</tr>
<tr>
<td style="text-align: right">6034</td>
<td style="text-align: left">InvalidReferrer</td>
<td style="text-align: left">InvalidReferrer</td>
</tr>
<tr>
<td style="text-align: right">6035</td>
<td style="text-align: left">InvalidOracle</td>
<td style="text-align: left">InvalidOracle</td>
</tr>
<tr>
<td style="text-align: right">6036</td>
<td style="text-align: left">OracleNotFound</td>
<td style="text-align: left">OracleNotFound</td>
</tr>
<tr>
<td style="text-align: right">6037</td>
<td style="text-align: left">LiquidationsBlockedByOracle</td>
<td style="text-align: left">Liquidations Blocked By Oracle</td>
</tr>
<tr>
<td style="text-align: right">6038</td>
<td style="text-align: left">MaxDeposit</td>
<td style="text-align: left">Can not deposit more than max deposit</td>
</tr>
<tr>
<td style="text-align: right">6039</td>
<td style="text-align: left">CantDeleteUserWithCollateral</td>
<td style="text-align: left">Can not delete user that still has collateral</td>
</tr>
<tr>
<td style="text-align: right">6040</td>
<td style="text-align: left">InvalidFundingProfitability</td>
<td style="text-align: left">AMM funding out of bounds pnl</td>
</tr>
<tr>
<td style="text-align: right">6041</td>
<td style="text-align: left">CastingFailure</td>
<td style="text-align: left">Casting Failure</td>
</tr>
<tr>
<td style="text-align: right">6042</td>
<td style="text-align: left">InvalidOrder</td>
<td style="text-align: left">InvalidOrder</td>
</tr>
<tr>
<td style="text-align: right">6043</td>
<td style="text-align: left">InvalidOrderMaxTs</td>
<td style="text-align: left">InvalidOrderMaxTs</td>
</tr>
<tr>
<td style="text-align: right">6044</td>
<td style="text-align: left">InvalidOrderMarketType</td>
<td style="text-align: left">InvalidOrderMarketType</td>
</tr>
<tr>
<td style="text-align: right">6045</td>
<td style="text-align: left">InvalidOrderForInitialMarginReq</td>
<td style="text-align: left">InvalidOrderForInitialMarginReq</td>
</tr>
<tr>
<td style="text-align: right">6046</td>
<td style="text-align: left">InvalidOrderNotRiskReducing</td>
<td style="text-align: left">InvalidOrderNotRiskReducing</td>
</tr>
<tr>
<td style="text-align: right">6047</td>
<td style="text-align: left">InvalidOrderSizeTooSmall</td>
<td style="text-align: left">InvalidOrderSizeTooSmall</td>
</tr>
<tr>
<td style="text-align: right">6048</td>
<td style="text-align: left">InvalidOrderNotStepSizeMultiple</td>
<td style="text-align: left">InvalidOrderNotStepSizeMultiple</td>
</tr>
<tr>
<td style="text-align: right">6049</td>
<td style="text-align: left">InvalidOrderBaseQuoteAsset</td>
<td style="text-align: left">InvalidOrderBaseQuoteAsset</td>
</tr>
<tr>
<td style="text-align: right">6050</td>
<td style="text-align: left">InvalidOrderIOC</td>
<td style="text-align: left">InvalidOrderIOC</td>
</tr>
<tr>
<td style="text-align: right">6051</td>
<td style="text-align: left">InvalidOrderPostOnly</td>
<td style="text-align: left">InvalidOrderPostOnly</td>
</tr>
<tr>
<td style="text-align: right">6052</td>
<td style="text-align: left">InvalidOrderIOCPostOnly</td>
<td style="text-align: left">InvalidOrderIOCPostOnly</td>
</tr>
<tr>
<td style="text-align: right">6053</td>
<td style="text-align: left">InvalidOrderTrigger</td>
<td style="text-align: left">InvalidOrderTrigger</td>
</tr>
<tr>
<td style="text-align: right">6054</td>
<td style="text-align: left">InvalidOrderAuction</td>
<td style="text-align: left">InvalidOrderAuction</td>
</tr>
<tr>
<td style="text-align: right">6055</td>
<td style="text-align: left">InvalidOrderOracleOffset</td>
<td style="text-align: left">InvalidOrderOracleOffset</td>
</tr>
<tr>
<td style="text-align: right">6056</td>
<td style="text-align: left">InvalidOrderMinOrderSize</td>
<td style="text-align: left">InvalidOrderMinOrderSize</td>
</tr>
<tr>
<td style="text-align: right">6057</td>
<td style="text-align: left">PlacePostOnlyLimitFailure</td>
<td style="text-align: left">Failed to Place Post-Only Limit Order</td>
</tr>
<tr>
<td style="text-align: right">6058</td>
<td style="text-align: left">UserHasNoOrder</td>
<td style="text-align: left">User has no order</td>
</tr>
<tr>
<td style="text-align: right">6059</td>
<td style="text-align: left">OrderAmountTooSmall</td>
<td style="text-align: left">Order Amount Too Small</td>
</tr>
<tr>
<td style="text-align: right">6060</td>
<td style="text-align: left">MaxNumberOfOrders</td>
<td style="text-align: left">Max number of orders taken</td>
</tr>
<tr>
<td style="text-align: right">6061</td>
<td style="text-align: left">OrderDoesNotExist</td>
<td style="text-align: left">Order does not exist</td>
</tr>
<tr>
<td style="text-align: right">6062</td>
<td style="text-align: left">OrderNotOpen</td>
<td style="text-align: left">Order not open</td>
</tr>
<tr>
<td style="text-align: right">6063</td>
<td style="text-align: left">FillOrderDidNotUpdateState</td>
<td style="text-align: left">FillOrderDidNotUpdateState</td>
</tr>
<tr>
<td style="text-align: right">6064</td>
<td style="text-align: left">ReduceOnlyOrderIncreasedRisk</td>
<td style="text-align: left">Reduce only order increased risk</td>
</tr>
<tr>
<td style="text-align: right">6065</td>
<td style="text-align: left">UnableToLoadAccountLoader</td>
<td style="text-align: left">Unable to load AccountLoader</td>
</tr>
<tr>
<td style="text-align: right">6066</td>
<td style="text-align: left">TradeSizeTooLarge</td>
<td style="text-align: left">Trade Size Too Large</td>
</tr>
<tr>
<td style="text-align: right">6067</td>
<td style="text-align: left">UserCantReferThemselves</td>
<td style="text-align: left">User cant refer themselves</td>
</tr>
<tr>
<td style="text-align: right">6068</td>
<td style="text-align: left">DidNotReceiveExpectedReferrer</td>
<td style="text-align: left">Did not receive expected referrer</td>
</tr>
<tr>
<td style="text-align: right">6069</td>
<td style="text-align: left">CouldNotDeserializeReferrer</td>
<td style="text-align: left">Could not deserialize referrer</td>
</tr>
<tr>
<td style="text-align: right">6070</td>
<td style="text-align: left">CouldNotDeserializeReferrerStats</td>
<td style="text-align: left">Could not deserialize referrer stats</td>
</tr>
<tr>
<td style="text-align: right">6071</td>
<td style="text-align: left">UserOrderIdAlreadyInUse</td>
<td style="text-align: left">User Order Id Already In Use</td>
</tr>
<tr>
<td style="text-align: right">6072</td>
<td style="text-align: left">NoPositionsLiquidatable</td>
<td style="text-align: left">No positions liquidatable</td>
</tr>
<tr>
<td style="text-align: right">6073</td>
<td style="text-align: left">InvalidMarginRatio</td>
<td style="text-align: left">Invalid Margin Ratio</td>
</tr>
<tr>
<td style="text-align: right">6074</td>
<td style="text-align: left">CantCancelPostOnlyOrder</td>
<td style="text-align: left">Cant Cancel Post Only Order</td>
</tr>
<tr>
<td style="text-align: right">6075</td>
<td style="text-align: left">InvalidOracleOffset</td>
<td style="text-align: left">InvalidOracleOffset</td>
</tr>
<tr>
<td style="text-align: right">6076</td>
<td style="text-align: left">CantExpireOrders</td>
<td style="text-align: left">CantExpireOrders</td>
</tr>
<tr>
<td style="text-align: right">6077</td>
<td style="text-align: left">CouldNotLoadMarketData</td>
<td style="text-align: left">CouldNotLoadMarketData</td>
</tr>
<tr>
<td style="text-align: right">6078</td>
<td style="text-align: left">PerpMarketNotFound</td>
<td style="text-align: left">PerpMarketNotFound</td>
</tr>
<tr>
<td style="text-align: right">6079</td>
<td style="text-align: left">InvalidMarketAccount</td>
<td style="text-align: left">InvalidMarketAccount</td>
</tr>
<tr>
<td style="text-align: right">6080</td>
<td style="text-align: left">UnableToLoadPerpMarketAccount</td>
<td style="text-align: left">UnableToLoadMarketAccount</td>
</tr>
<tr>
<td style="text-align: right">6081</td>
<td style="text-align: left">MarketWrongMutability</td>
<td style="text-align: left">MarketWrongMutability</td>
</tr>
<tr>
<td style="text-align: right">6082</td>
<td style="text-align: left">UnableToCastUnixTime</td>
<td style="text-align: left">UnableToCastUnixTime</td>
</tr>
<tr>
<td style="text-align: right">6083</td>
<td style="text-align: left">CouldNotFindSpotPosition</td>
<td style="text-align: left">CouldNotFindSpotPosition</td>
</tr>
<tr>
<td style="text-align: right">6084</td>
<td style="text-align: left">NoSpotPositionAvailable</td>
<td style="text-align: left">NoSpotPositionAvailable</td>
</tr>
<tr>
<td style="text-align: right">6085</td>
<td style="text-align: left">InvalidSpotMarketInitialization</td>
<td style="text-align: left">InvalidSpotMarketInitialization</td>
</tr>
<tr>
<td style="text-align: right">6086</td>
<td style="text-align: left">CouldNotLoadSpotMarketData</td>
<td style="text-align: left">CouldNotLoadSpotMarketData</td>
</tr>
<tr>
<td style="text-align: right">6087</td>
<td style="text-align: left">SpotMarketNotFound</td>
<td style="text-align: left">SpotMarketNotFound</td>
</tr>
<tr>
<td style="text-align: right">6088</td>
<td style="text-align: left">InvalidSpotMarketAccount</td>
<td style="text-align: left">InvalidSpotMarketAccount</td>
</tr>
<tr>
<td style="text-align: right">6089</td>
<td style="text-align: left">UnableToLoadSpotMarketAccount</td>
<td style="text-align: left">UnableToLoadSpotMarketAccount</td>
</tr>
<tr>
<td style="text-align: right">6090</td>
<td style="text-align: left">SpotMarketWrongMutability</td>
<td style="text-align: left">SpotMarketWrongMutability</td>
</tr>
<tr>
<td style="text-align: right">6091</td>
<td style="text-align: left">SpotMarketInterestNotUpToDate</td>
<td style="text-align: left">SpotInterestNotUpToDate</td>
</tr>
<tr>
<td style="text-align: right">6092</td>
<td style="text-align: left">SpotMarketInsufficientDeposits</td>
<td style="text-align: left">SpotMarketInsufficientDeposits</td>
</tr>
<tr>
<td style="text-align: right">6093</td>
<td style="text-align: left">UserMustSettleTheirOwnPositiveUnsettledPNL</td>
<td style="text-align: left">UserMustSettleTheirOwnPositiveUnsettledPNL</td>
</tr>
<tr>
<td style="text-align: right">6094</td>
<td style="text-align: left">CantUpdatePoolBalanceType</td>
<td style="text-align: left">CantUpdatePoolBalanceType</td>
</tr>
<tr>
<td style="text-align: right">6095</td>
<td style="text-align: left">InsufficientCollateralForSettlingPNL</td>
<td style="text-align: left">InsufficientCollateralForSettlingPNL</td>
</tr>
<tr>
<td style="text-align: right">6096</td>
<td style="text-align: left">AMMNotUpdatedInSameSlot</td>
<td style="text-align: left">AMMNotUpdatedInSameSlot</td>
</tr>
<tr>
<td style="text-align: right">6097</td>
<td style="text-align: left">AuctionNotComplete</td>
<td style="text-align: left">AuctionNotComplete</td>
</tr>
<tr>
<td style="text-align: right">6098</td>
<td style="text-align: left">MakerNotFound</td>
<td style="text-align: left">MakerNotFound</td>
</tr>
<tr>
<td style="text-align: right">6099</td>
<td style="text-align: left">MakerStatsNotFound</td>
<td style="text-align: left">MakerNotFound</td>
</tr>
<tr>
<td style="text-align: right">6100</td>
<td style="text-align: left">MakerMustBeWritable</td>
<td style="text-align: left">MakerMustBeWritable</td>
</tr>
<tr>
<td style="text-align: right">6101</td>
<td style="text-align: left">MakerStatsMustBeWritable</td>
<td style="text-align: left">MakerMustBeWritable</td>
</tr>
<tr>
<td style="text-align: right">6102</td>
<td style="text-align: left">MakerOrderNotFound</td>
<td style="text-align: left">MakerOrderNotFound</td>
</tr>
<tr>
<td style="text-align: right">6103</td>
<td style="text-align: left">CouldNotDeserializeMaker</td>
<td style="text-align: left">CouldNotDeserializeMaker</td>
</tr>
<tr>
<td style="text-align: right">6104</td>
<td style="text-align: left">CouldNotDeserializeMakerStats</td>
<td style="text-align: left">CouldNotDeserializeMaker</td>
</tr>
<tr>
<td style="text-align: right">6105</td>
<td style="text-align: left">AuctionPriceDoesNotSatisfyMaker</td>
<td style="text-align: left">AuctionPriceDoesNotSatisfyMaker</td>
</tr>
<tr>
<td style="text-align: right">6106</td>
<td style="text-align: left">MakerCantFulfillOwnOrder</td>
<td style="text-align: left">MakerCantFulfillOwnOrder</td>
</tr>
<tr>
<td style="text-align: right">6107</td>
<td style="text-align: left">MakerOrderMustBePostOnly</td>
<td style="text-align: left">MakerOrderMustBePostOnly</td>
</tr>
<tr>
<td style="text-align: right">6108</td>
<td style="text-align: left">CantMatchTwoPostOnlys</td>
<td style="text-align: left">CantMatchTwoPostOnlys</td>
</tr>
<tr>
<td style="text-align: right">6109</td>
<td style="text-align: left">OrderBreachesOraclePriceLimits</td>
<td style="text-align: left">OrderBreachesOraclePriceLimits</td>
</tr>
<tr>
<td style="text-align: right">6110</td>
<td style="text-align: left">OrderMustBeTriggeredFirst</td>
<td style="text-align: left">OrderMustBeTriggeredFirst</td>
</tr>
<tr>
<td style="text-align: right">6111</td>
<td style="text-align: left">OrderNotTriggerable</td>
<td style="text-align: left">OrderNotTriggerable</td>
</tr>
<tr>
<td style="text-align: right">6112</td>
<td style="text-align: left">OrderDidNotSatisfyTriggerCondition</td>
<td style="text-align: left">OrderDidNotSatisfyTriggerCondition</td>
</tr>
<tr>
<td style="text-align: right">6113</td>
<td style="text-align: left">PositionAlreadyBeingLiquidated</td>
<td style="text-align: left">PositionAlreadyBeingLiquidated</td>
</tr>
<tr>
<td style="text-align: right">6114</td>
<td style="text-align: left">PositionDoesntHaveOpenPositionOrOrders</td>
<td style="text-align: left">PositionDoesntHaveOpenPositionOrOrders</td>
</tr>
<tr>
<td style="text-align: right">6115</td>
<td style="text-align: left">AllOrdersAreAlreadyLiquidations</td>
<td style="text-align: left">AllOrdersAreAlreadyLiquidations</td>
</tr>
<tr>
<td style="text-align: right">6116</td>
<td style="text-align: left">CantCancelLiquidationOrder</td>
<td style="text-align: left">CantCancelLiquidationOrder</td>
</tr>
<tr>
<td style="text-align: right">6117</td>
<td style="text-align: left">UserIsBeingLiquidated</td>
<td style="text-align: left">UserIsBeingLiquidated</td>
</tr>
<tr>
<td style="text-align: right">6118</td>
<td style="text-align: left">LiquidationsOngoing</td>
<td style="text-align: left">LiquidationsOngoing</td>
</tr>
<tr>
<td style="text-align: right">6119</td>
<td style="text-align: left">WrongSpotBalanceType</td>
<td style="text-align: left">WrongSpotBalanceType</td>
</tr>
<tr>
<td style="text-align: right">6120</td>
<td style="text-align: left">UserCantLiquidateThemself</td>
<td style="text-align: left">UserCantLiquidateThemself</td>
</tr>
<tr>
<td style="text-align: right">6121</td>
<td style="text-align: left">InvalidPerpPositionToLiquidate</td>
<td style="text-align: left">InvalidPerpPositionToLiquidate</td>
</tr>
<tr>
<td style="text-align: right">6122</td>
<td style="text-align: left">InvalidBaseAssetAmountForLiquidatePerp</td>
<td style="text-align: left">InvalidBaseAssetAmountForLiquidatePerp</td>
</tr>
<tr>
<td style="text-align: right">6123</td>
<td style="text-align: left">InvalidPositionLastFundingRate</td>
<td style="text-align: left">InvalidPositionLastFundingRate</td>
</tr>
<tr>
<td style="text-align: right">6124</td>
<td style="text-align: left">InvalidPositionDelta</td>
<td style="text-align: left">InvalidPositionDelta</td>
</tr>
<tr>
<td style="text-align: right">6125</td>
<td style="text-align: left">UserBankrupt</td>
<td style="text-align: left">UserBankrupt</td>
</tr>
<tr>
<td style="text-align: right">6126</td>
<td style="text-align: left">UserNotBankrupt</td>
<td style="text-align: left">UserNotBankrupt</td>
</tr>
<tr>
<td style="text-align: right">6127</td>
<td style="text-align: left">UserHasInvalidBorrow</td>
<td style="text-align: left">UserHasInvalidBorrow</td>
</tr>
<tr>
<td style="text-align: right">6128</td>
<td style="text-align: left">DailyWithdrawLimit</td>
<td style="text-align: left">DailyWithdrawLimit</td>
</tr>
<tr>
<td style="text-align: right">6129</td>
<td style="text-align: left">DefaultError</td>
<td style="text-align: left">DefaultError</td>
</tr>
<tr>
<td style="text-align: right">6130</td>
<td style="text-align: left">InsufficientLPTokens</td>
<td style="text-align: left">Insufficient LP tokens</td>
</tr>
<tr>
<td style="text-align: right">6131</td>
<td style="text-align: left">CantLPWithPerpPosition</td>
<td style="text-align: left">Cant LP with a market position</td>
</tr>
<tr>
<td style="text-align: right">6132</td>
<td style="text-align: left">UnableToBurnLPTokens</td>
<td style="text-align: left">Unable to burn LP tokens</td>
</tr>
<tr>
<td style="text-align: right">6133</td>
<td style="text-align: left">TryingToRemoveLiquidityTooFast</td>
<td style="text-align: left">Trying to remove liqudity too fast after adding it</td>
</tr>
<tr>
<td style="text-align: right">6134</td>
<td style="text-align: left">InvalidSpotMarketVault</td>
<td style="text-align: left">Invalid Spot Market Vault</td>
</tr>
<tr>
<td style="text-align: right">6135</td>
<td style="text-align: left">InvalidSpotMarketState</td>
<td style="text-align: left">Invalid Spot Market State</td>
</tr>
<tr>
<td style="text-align: right">6136</td>
<td style="text-align: left">InvalidSerumProgram</td>
<td style="text-align: left">InvalidSerumProgram</td>
</tr>
<tr>
<td style="text-align: right">6137</td>
<td style="text-align: left">InvalidSerumMarket</td>
<td style="text-align: left">InvalidSerumMarket</td>
</tr>
<tr>
<td style="text-align: right">6138</td>
<td style="text-align: left">InvalidSerumBids</td>
<td style="text-align: left">InvalidSerumBids</td>
</tr>
<tr>
<td style="text-align: right">6139</td>
<td style="text-align: left">InvalidSerumAsks</td>
<td style="text-align: left">InvalidSerumAsks</td>
</tr>
<tr>
<td style="text-align: right">6140</td>
<td style="text-align: left">InvalidSerumOpenOrders</td>
<td style="text-align: left">InvalidSerumOpenOrders</td>
</tr>
<tr>
<td style="text-align: right">6141</td>
<td style="text-align: left">FailedSerumCPI</td>
<td style="text-align: left">FailedSerumCPI</td>
</tr>
<tr>
<td style="text-align: right">6142</td>
<td style="text-align: left">FailedToFillOnExternalMarket</td>
<td style="text-align: left">FailedToFillOnExternalMarket</td>
</tr>
<tr>
<td style="text-align: right">6143</td>
<td style="text-align: left">InvalidFulfillmentConfig</td>
<td style="text-align: left">InvalidFulfillmentConfig</td>
</tr>
<tr>
<td style="text-align: right">6144</td>
<td style="text-align: left">InvalidFeeStructure</td>
<td style="text-align: left">InvalidFeeStructure</td>
</tr>
<tr>
<td style="text-align: right">6145</td>
<td style="text-align: left">InsufficientIFShares</td>
<td style="text-align: left">Insufficient IF shares</td>
</tr>
<tr>
<td style="text-align: right">6146</td>
<td style="text-align: left">MarketActionPaused</td>
<td style="text-align: left">the Market has paused this action</td>
</tr>
<tr>
<td style="text-align: right">6147</td>
<td style="text-align: left">MarketPlaceOrderPaused</td>
<td style="text-align: left">the Market status doesnt allow placing orders</td>
</tr>
<tr>
<td style="text-align: right">6148</td>
<td style="text-align: left">MarketFillOrderPaused</td>
<td style="text-align: left">the Market status doesnt allow filling orders</td>
</tr>
<tr>
<td style="text-align: right">6149</td>
<td style="text-align: left">MarketWithdrawPaused</td>
<td style="text-align: left">the Market status doesnt allow withdraws</td>
</tr>
<tr>
<td style="text-align: right">6150</td>
<td style="text-align: left">ProtectedAssetTierViolation</td>
<td style="text-align: left">Action violates the Protected Asset Tier rules</td>
</tr>
<tr>
<td style="text-align: right">6151</td>
<td style="text-align: left">IsolatedAssetTierViolation</td>
<td style="text-align: left">Action violates the Isolated Asset Tier rules</td>
</tr>
<tr>
<td style="text-align: right">6152</td>
<td style="text-align: left">UserCantBeDeleted</td>
<td style="text-align: left">User Cant Be Deleted</td>
</tr>
<tr>
<td style="text-align: right">6153</td>
<td style="text-align: left">ReduceOnlyWithdrawIncreasedRisk</td>
<td style="text-align: left">Reduce Only Withdraw Increased Risk</td>
</tr>
<tr>
<td style="text-align: right">6154</td>
<td style="text-align: left">MaxOpenInterest</td>
<td style="text-align: left">Max Open Interest</td>
</tr>
<tr>
<td style="text-align: right">6155</td>
<td style="text-align: left">CantResolvePerpBankruptcy</td>
<td style="text-align: left">Cant Resolve Perp Bankruptcy</td>
</tr>
<tr>
<td style="text-align: right">6156</td>
<td style="text-align: left">LiquidationDoesntSatisfyLimitPrice</td>
<td style="text-align: left">Liquidation Doesnt Satisfy Limit Price</td>
</tr>
<tr>
<td style="text-align: right">6157</td>
<td style="text-align: left">MarginTradingDisabled</td>
<td style="text-align: left">Margin Trading Disabled</td>
</tr>
<tr>
<td style="text-align: right">6158</td>
<td style="text-align: left">InvalidMarketStatusToSettlePnl</td>
<td style="text-align: left">Invalid Market Status to Settle Perp Pnl</td>
</tr>
<tr>
<td style="text-align: right">6159</td>
<td style="text-align: left">PerpMarketNotInSettlement</td>
<td style="text-align: left">PerpMarketNotInSettlement</td>
</tr>
<tr>
<td style="text-align: right">6160</td>
<td style="text-align: left">PerpMarketNotInReduceOnly</td>
<td style="text-align: left">PerpMarketNotInReduceOnly</td>
</tr>
<tr>
<td style="text-align: right">6161</td>
<td style="text-align: left">PerpMarketSettlementBufferNotReached</td>
<td style="text-align: left">PerpMarketSettlementBufferNotReached</td>
</tr>
<tr>
<td style="text-align: right">6162</td>
<td style="text-align: left">PerpMarketSettlementUserHasOpenOrders</td>
<td style="text-align: left">PerpMarketSettlementUserHasOpenOrders</td>
</tr>
<tr>
<td style="text-align: right">6163</td>
<td style="text-align: left">PerpMarketSettlementUserHasActiveLP</td>
<td style="text-align: left">PerpMarketSettlementUserHasActiveLP</td>
</tr>
<tr>
<td style="text-align: right">6164</td>
<td style="text-align: left">UnableToSettleExpiredUserPosition</td>
<td style="text-align: left">UnableToSettleExpiredUserPosition</td>
</tr>
<tr>
<td style="text-align: right">6165</td>
<td style="text-align: left">UnequalMarketIndexForSpotTransfer</td>
<td style="text-align: left">UnequalMarketIndexForSpotTransfer</td>
</tr>
<tr>
<td style="text-align: right">6166</td>
<td style="text-align: left">InvalidPerpPositionDetected</td>
<td style="text-align: left">InvalidPerpPositionDetected</td>
</tr>
<tr>
<td style="text-align: right">6167</td>
<td style="text-align: left">InvalidSpotPositionDetected</td>
<td style="text-align: left">InvalidSpotPositionDetected</td>
</tr>
<tr>
<td style="text-align: right">6168</td>
<td style="text-align: left">InvalidAmmDetected</td>
<td style="text-align: left">InvalidAmmDetected</td>
</tr>
<tr>
<td style="text-align: right">6169</td>
<td style="text-align: left">InvalidAmmForFillDetected</td>
<td style="text-align: left">InvalidAmmForFillDetected</td>
</tr>
<tr>
<td style="text-align: right">6170</td>
<td style="text-align: left">InvalidAmmLimitPriceOverride</td>
<td style="text-align: left">InvalidAmmLimitPriceOverride</td>
</tr>
<tr>
<td style="text-align: right">6171</td>
<td style="text-align: left">InvalidOrderFillPrice</td>
<td style="text-align: left">InvalidOrderFillPrice</td>
</tr>
<tr>
<td style="text-align: right">6172</td>
<td style="text-align: left">SpotMarketBalanceInvariantViolated</td>
<td style="text-align: left">SpotMarketBalanceInvariantViolated</td>
</tr>
<tr>
<td style="text-align: right">6173</td>
<td style="text-align: left">SpotMarketVaultInvariantViolated</td>
<td style="text-align: left">SpotMarketVaultInvariantViolated</td>
</tr>
<tr>
<td style="text-align: right">6174</td>
<td style="text-align: left">InvalidPDA</td>
<td style="text-align: left">InvalidPDA</td>
</tr>
<tr>
<td style="text-align: right">6175</td>
<td style="text-align: left">InvalidPDASigner</td>
<td style="text-align: left">InvalidPDASigner</td>
</tr>
<tr>
<td style="text-align: right">6176</td>
<td style="text-align: left">RevenueSettingsCannotSettleToIF</td>
<td style="text-align: left">RevenueSettingsCannotSettleToIF</td>
</tr>
<tr>
<td style="text-align: right">6177</td>
<td style="text-align: left">NoRevenueToSettleToIF</td>
<td style="text-align: left">NoRevenueToSettleToIF</td>
</tr>
<tr>
<td style="text-align: right">6178</td>
<td style="text-align: left">NoAmmPerpPnlDeficit</td>
<td style="text-align: left">NoAmmPerpPnlDeficit</td>
</tr>
<tr>
<td style="text-align: right">6179</td>
<td style="text-align: left">SufficientPerpPnlPool</td>
<td style="text-align: left">SufficientPerpPnlPool</td>
</tr>
<tr>
<td style="text-align: right">6180</td>
<td style="text-align: left">InsufficientPerpPnlPool</td>
<td style="text-align: left">InsufficientPerpPnlPool</td>
</tr>
<tr>
<td style="text-align: right">6181</td>
<td style="text-align: left">PerpPnlDeficitBelowThreshold</td>
<td style="text-align: left">PerpPnlDeficitBelowThreshold</td>
</tr>
<tr>
<td style="text-align: right">6182</td>
<td style="text-align: left">MaxRevenueWithdrawPerPeriodReached</td>
<td style="text-align: left">MaxRevenueWithdrawPerPeriodReached</td>
</tr>
<tr>
<td style="text-align: right">6183</td>
<td style="text-align: left">MaxIFWithdrawReached</td>
<td style="text-align: left">InvalidSpotPositionDetected</td>
</tr>
<tr>
<td style="text-align: right">6184</td>
<td style="text-align: left">NoIFWithdrawAvailable</td>
<td style="text-align: left">NoIFWithdrawAvailable</td>
</tr>
<tr>
<td style="text-align: right">6185</td>
<td style="text-align: left">InvalidIFUnstake</td>
<td style="text-align: left">InvalidIFUnstake</td>
</tr>
<tr>
<td style="text-align: right">6186</td>
<td style="text-align: left">InvalidIFUnstakeSize</td>
<td style="text-align: left">InvalidIFUnstakeSize</td>
</tr>
<tr>
<td style="text-align: right">6187</td>
<td style="text-align: left">InvalidIFUnstakeCancel</td>
<td style="text-align: left">InvalidIFUnstakeCancel</td>
</tr>
<tr>
<td style="text-align: right">6188</td>
<td style="text-align: left">InvalidIFForNewStakes</td>
<td style="text-align: left">InvalidIFForNewStakes</td>
</tr>
<tr>
<td style="text-align: right">6189</td>
<td style="text-align: left">InvalidIFRebase</td>
<td style="text-align: left">InvalidIFRebase</td>
</tr>
<tr>
<td style="text-align: right">6190</td>
<td style="text-align: left">InvalidInsuranceUnstakeSize</td>
<td style="text-align: left">InvalidInsuranceUnstakeSize</td>
</tr>
<tr>
<td style="text-align: right">6191</td>
<td style="text-align: left">InvalidOrderLimitPrice</td>
<td style="text-align: left">InvalidOrderLimitPrice</td>
</tr>
<tr>
<td style="text-align: right">6192</td>
<td style="text-align: left">InvalidIFDetected</td>
<td style="text-align: left">InvalidIFDetected</td>
</tr>
<tr>
<td style="text-align: right">6193</td>
<td style="text-align: left">InvalidAmmMaxSpreadDetected</td>
<td style="text-align: left">InvalidAmmMaxSpreadDetected</td>
</tr>
<tr>
<td style="text-align: right">6194</td>
<td style="text-align: left">InvalidConcentrationCoef</td>
<td style="text-align: left">InvalidConcentrationCoef</td>
</tr>
<tr>
<td style="text-align: right">6195</td>
<td style="text-align: left">InvalidSrmVault</td>
<td style="text-align: left">InvalidSrmVault</td>
</tr>
<tr>
<td style="text-align: right">6196</td>
<td style="text-align: left">InvalidVaultOwner</td>
<td style="text-align: left">InvalidVaultOwner</td>
</tr>
<tr>
<td style="text-align: right">6197</td>
<td style="text-align: left">InvalidMarketStatusForFills</td>
<td style="text-align: left">InvalidMarketStatusForFills</td>
</tr>
<tr>
<td style="text-align: right">6198</td>
<td style="text-align: left">IFWithdrawRequestInProgress</td>
<td style="text-align: left">IFWithdrawRequestInProgress</td>
</tr>
<tr>
<td style="text-align: right">6199</td>
<td style="text-align: left">NoIFWithdrawRequestInProgress</td>
<td style="text-align: left">NoIFWithdrawRequestInProgress</td>
</tr>
<tr>
<td style="text-align: right">6200</td>
<td style="text-align: left">IFWithdrawRequestTooSmall</td>
<td style="text-align: left">IFWithdrawRequestTooSmall</td>
</tr>
<tr>
<td style="text-align: right">6201</td>
<td style="text-align: left">IncorrectSpotMarketAccountPassed</td>
<td style="text-align: left">IncorrectSpotMarketAccountPassed</td>
</tr>
<tr>
<td style="text-align: right">6202</td>
<td style="text-align: left">BlockchainClockInconsistency</td>
<td style="text-align: left">BlockchainClockInconsistency</td>
</tr>
<tr>
<td style="text-align: right">6203</td>
<td style="text-align: left">InvalidIFSharesDetected</td>
<td style="text-align: left">InvalidIFSharesDetected</td>
</tr>
<tr>
<td style="text-align: right">6204</td>
<td style="text-align: left">NewLPSizeTooSmall</td>
<td style="text-align: left">NewLPSizeTooSmall</td>
</tr>
<tr>
<td style="text-align: right">6205</td>
<td style="text-align: left">MarketStatusInvalidForNewLP</td>
<td style="text-align: left">MarketStatusInvalidForNewLP</td>
</tr>
<tr>
<td style="text-align: right">6206</td>
<td style="text-align: left">InvalidMarkTwapUpdateDetected</td>
<td style="text-align: left">InvalidMarkTwapUpdateDetected</td>
</tr>
<tr>
<td style="text-align: right">6207</td>
<td style="text-align: left">MarketSettlementAttemptOnActiveMarket</td>
<td style="text-align: left">MarketSettlementAttemptOnActiveMarket</td>
</tr>
<tr>
<td style="text-align: right">6208</td>
<td style="text-align: left">MarketSettlementRequiresSettledLP</td>
<td style="text-align: left">MarketSettlementRequiresSettledLP</td>
</tr>
<tr>
<td style="text-align: right">6209</td>
<td style="text-align: left">MarketSettlementAttemptTooEarly</td>
<td style="text-align: left">MarketSettlementAttemptTooEarly</td>
</tr>
<tr>
<td style="text-align: right">6210</td>
<td style="text-align: left">MarketSettlementTargetPriceInvalid</td>
<td style="text-align: left">MarketSettlementTargetPriceInvalid</td>
</tr>
<tr>
<td style="text-align: right">6211</td>
<td style="text-align: left">UnsupportedSpotMarket</td>
<td style="text-align: left">UnsupportedSpotMarket</td>
</tr>
<tr>
<td style="text-align: right">6212</td>
<td style="text-align: left">SpotOrdersDisabled</td>
<td style="text-align: left">SpotOrdersDisabled</td>
</tr>
<tr>
<td style="text-align: right">6213</td>
<td style="text-align: left">MarketBeingInitialized</td>
<td style="text-align: left">Market Being Initialized</td>
</tr>
<tr>
<td style="text-align: right">6214</td>
<td style="text-align: left">InvalidUserSubAccountId</td>
<td style="text-align: left">Invalid Sub Account Id</td>
</tr>
<tr>
<td style="text-align: right">6215</td>
<td style="text-align: left">InvalidTriggerOrderCondition</td>
<td style="text-align: left">Invalid Trigger Order Condition</td>
</tr>
<tr>
<td style="text-align: right">6216</td>
<td style="text-align: left">InvalidSpotPosition</td>
<td style="text-align: left">Invalid Spot Position</td>
</tr>
<tr>
<td style="text-align: right">6217</td>
<td style="text-align: left">CantTransferBetweenSameUserAccount</td>
<td style="text-align: left">Cant transfer between same user account</td>
</tr>
<tr>
<td style="text-align: right">6218</td>
<td style="text-align: left">InvalidPerpPosition</td>
<td style="text-align: left">Invalid Perp Position</td>
</tr>
<tr>
<td style="text-align: right">6219</td>
<td style="text-align: left">UnableToGetLimitPrice</td>
<td style="text-align: left">Unable To Get Limit Price</td>
</tr>
<tr>
<td style="text-align: right">6220</td>
<td style="text-align: left">InvalidLiquidation</td>
<td style="text-align: left">Invalid Liquidation</td>
</tr>
<tr>
<td style="text-align: right">6221</td>
<td style="text-align: left">SpotFulfillmentConfigDisabled</td>
<td style="text-align: left">Spot Fulfullment Config Disabled</td>
</tr>
<tr>
<td style="text-align: right">6222</td>
<td style="text-align: left">InvalidMaker</td>
<td style="text-align: left">Invalid Maker</td>
</tr>
<tr>
<td style="text-align: right">6223</td>
<td style="text-align: left">FailedUnwrap</td>
<td style="text-align: left">Failed Unwrap</td>
</tr>
<tr>
<td style="text-align: right">6224</td>
<td style="text-align: left">MaxNumberOfUsers</td>
<td style="text-align: left">Max Number Of Users</td>
</tr>
<tr>
<td style="text-align: right">6225</td>
<td style="text-align: left">InvalidOracleForSettlePnl</td>
<td style="text-align: left">InvalidOracleForSettlePnl</td>
</tr>
<tr>
<td style="text-align: right">6226</td>
<td style="text-align: left">MarginOrdersOpen</td>
<td style="text-align: left">MarginOrdersOpen</td>
</tr>
<tr>
<td style="text-align: right">6227</td>
<td style="text-align: left">TierViolationLiquidatingPerpPnl</td>
<td style="text-align: left">TierViolationLiquidatingPerpPnl</td>
</tr>
<tr>
<td style="text-align: right">6228</td>
<td style="text-align: left">CouldNotLoadUserData</td>
<td style="text-align: left">CouldNotLoadUserData</td>
</tr>
<tr>
<td style="text-align: right">6229</td>
<td style="text-align: left">UserWrongMutability</td>
<td style="text-align: left">UserWrongMutability</td>
</tr>
<tr>
<td style="text-align: right">6230</td>
<td style="text-align: left">InvalidUserAccount</td>
<td style="text-align: left">InvalidUserAccount</td>
</tr>
<tr>
<td style="text-align: right">6231</td>
<td style="text-align: left">CouldNotLoadUserStatsData</td>
<td style="text-align: left">CouldNotLoadUserData</td>
</tr>
<tr>
<td style="text-align: right">6232</td>
<td style="text-align: left">UserStatsWrongMutability</td>
<td style="text-align: left">UserWrongMutability</td>
</tr>
<tr>
<td style="text-align: right">6233</td>
<td style="text-align: left">InvalidUserStatsAccount</td>
<td style="text-align: left">InvalidUserAccount</td>
</tr>
<tr>
<td style="text-align: right">6234</td>
<td style="text-align: left">UserNotFound</td>
<td style="text-align: left">UserNotFound</td>
</tr>
<tr>
<td style="text-align: right">6235</td>
<td style="text-align: left">UnableToLoadUserAccount</td>
<td style="text-align: left">UnableToLoadUserAccount</td>
</tr>
<tr>
<td style="text-align: right">6236</td>
<td style="text-align: left">UserStatsNotFound</td>
<td style="text-align: left">UserStatsNotFound</td>
</tr>
<tr>
<td style="text-align: right">6237</td>
<td style="text-align: left">UnableToLoadUserStatsAccount</td>
<td style="text-align: left">UnableToLoadUserStatsAccount</td>
</tr>
<tr>
<td style="text-align: right">6238</td>
<td style="text-align: left">UserNotInactive</td>
<td style="text-align: left">User Not Inactive</td>
</tr>
<tr>
<td style="text-align: right">6239</td>
<td style="text-align: left">RevertFill</td>
<td style="text-align: left">RevertFill</td>
</tr>
<tr>
<td style="text-align: right">6240</td>
<td style="text-align: left">InvalidMarketAccountforDeletion</td>
<td style="text-align: left">Invalid MarketAccount for Deletion</td>
</tr>
<tr>
<td style="text-align: right">6241</td>
<td style="text-align: left">InvalidSpotFulfillmentParams</td>
<td style="text-align: left">Invalid Spot Fulfillment Params</td>
</tr>
<tr>
<td style="text-align: right">6242</td>
<td style="text-align: left">FailedToGetMint</td>
<td style="text-align: left">Failed to Get Mint</td>
</tr>
<tr>
<td style="text-align: right">6243</td>
<td style="text-align: left">FailedPhoenixCPI</td>
<td style="text-align: left">FailedPhoenixCPI</td>
</tr>
<tr>
<td style="text-align: right">6244</td>
<td style="text-align: left">FailedToDeserializePhoenixMarket</td>
<td style="text-align: left">FailedToDeserializePhoenixMarket</td>
</tr>
<tr>
<td style="text-align: right">6245</td>
<td style="text-align: left">InvalidPricePrecision</td>
<td style="text-align: left">InvalidPricePrecision</td>
</tr>
<tr>
<td style="text-align: right">6246</td>
<td style="text-align: left">InvalidPhoenixProgram</td>
<td style="text-align: left">InvalidPhoenixProgram</td>
</tr>
<tr>
<td style="text-align: right">6247</td>
<td style="text-align: left">InvalidPhoenixMarket</td>
<td style="text-align: left">InvalidPhoenixMarket</td>
</tr>
</tbody></table>
<h1 id='market-indexes-names'>Market Indexes/Names</h1>
<p>All spot and perp markets contain a market index and name field on chain.
You can also find the <a href="https://github.com/drift-labs/protocol-v2/blob/master/sdk/src/constants/perpMarkets.ts">perp</a> and <a href="https://github.com/drift-labs/protocol-v2/blob/master/sdk/src/constants/spotMarkets.ts">spot</a> market indexes and names in the typescript sdk constants.</p>
<h1 id='prediction-markets'>Prediction Markets</h1>
<p>Prediction Markets are Perp Markets with the <code>contract_type</code> set as <code>Prediction</code>.</p>

<p>Prediction Markets function the same as Perp Markets with the following additional constraints:</p>

<ul>
<li>Prices must be between 0 and 1</li>
<li>Funding is paused</li>
<li>Margin ratios are set to 1 so that the position is fully collateralized</li>
<li>The margin system uses <code>1 - oracle price</code> to value short positions</li>
<li>They use prelaunch oracles (the oracle price is the mark twap)</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="typescript">typescript</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="shell">http</a>
          </div>
      </div>
    </div>
  </body>
</html>
